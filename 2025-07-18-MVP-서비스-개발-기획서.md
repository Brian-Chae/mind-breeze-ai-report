# Mind Breeze AI - MVP 서비스 개발 기획서
**작성일**: 2025년 7월 18일  
**버전**: v1.0  
**목표**: AI Report 기능 완성 후 나머지 핵심 기능 체계적 개발  

---

## 📋 프로젝트 개요

### 🎯 목적
- **AI Report 기능이 완성된 상태**에서 나머지 핵심 서비스 기능들을 체계적으로 개발
- 시스템 관리자와 조직 관리자의 명확한 역할 분리
- B2B 서비스 중심의 사용자 관리, 디바이스 관리, 조직 관리 구현
- 실제 운영 가능한 MVP 서비스 완성

### 🔄 현재 상황 (2025년 7월 기준)

#### ✅ **완성된 기능들**
```
✅ AI Report 시스템 (완전 구현)
   ├── AIReportSection.tsx (3,081 lines)
   ├── 리포트 생성 엔진 (BasicGeminiV1Engine)
   ├── 리포트 렌더러 (Web/Mobile)
   ├── 품질 관리 시스템
   └── 측정 데이터 관리

✅ Credit Management Service (완전 구현)
   ├── CreditManagementService.ts (737 lines)
   ├── 볼륨 할인 계산
   ├── 크레딧 관리 (충전/사용)
   ├── 체험 서비스 관리
   └── 환불 처리

✅ 기본 인프라
   ├── Firebase 설정
   ├── 사용자 권한 시스템 (UserType 기반)
   ├── OrganizationAdmin 기본 구조
   ├── 라우팅 시스템
   └── UI 컴포넌트 라이브러리
```

#### ❌ **개발 필요 영역들**
```
❌ 시스템/조직 관리자 분기 처리
❌ MemberManagementService (구현 필요)
❌ OrganizationService (완성 필요)
❌ DeviceManagementService (구현 필요)
❌ UserManagementService (MEASUREMENT_SUBJECT 관리)
❌ 시스템 관리자 전용 기능
```

---

## 🚀 4단계 개발 계획

### **📌 1단계: 시스템/조직 관리자 분기 처리 (1주) - 최우선**

#### 🎯 목표
현재 OrganizationAdminApp에서 `SYSTEM_ADMIN`과 `ORGANIZATION_ADMIN`을 구분하여 다른 접근 권한과 메뉴를 제공

#### 🔧 주요 작업
```typescript
// 1. 사용자 타입별 메뉴 분리
SYSTEM_ADMIN 전용:
  - 📊 시스템 대시보드 (전체 조직 현황)
  - 🏢 전체 조직 관리 
  - 👥 시스템 사용자 관리
  - 📈 시스템 통계 및 모니터링
  - ⚙️ 시스템 설정

ORGANIZATION_ADMIN 전용:
  - 📊 조직 대시보드 (자신 조직만)
  - 👥 멤버 관리 (자신 조직만)
  - 👤 사용자 관리 (자신 조직만)
  - 🧠 AI Report (자신 조직만)
  - 📱 디바이스 관리 (자신 조직만)
  - 💳 크레딧 관리 (자신 조직만)
```

#### 📋 세부 구현
- [ ] `OrganizationAdminApp.tsx`에서 `userType` 기반 메뉴 분기
- [ ] `SystemAdminDashboard.tsx` 새로 생성
- [ ] `OrganizationAdminDashboard.tsx` 수정
- [ ] 권한 기반 라우팅 가드 구현
- [ ] 데이터 접근 권한 체크 로직 추가

---

### **🏗️ 2단계: 핵심 서비스 완성 (2주)**

#### 🎯 목표
이미 골격이 있는 서비스들을 완성하여 실제 사용 가능한 기능 구현

#### Week 1: 멤버 및 조직 관리
```typescript
// MemberManagementService.ts 완성
class MemberManagementService {
  // 멤버 초대 시스템
  async inviteMember(email: string, role: MemberRole): Promise<Invitation>
  async resendInvitation(invitationId: string): Promise<void>
  async cancelInvitation(invitationId: string): Promise<void>
  
  // 멤버 관리
  async updateMemberRole(memberId: string, newRole: MemberRole): Promise<void>
  async updateMemberPermissions(memberId: string, permissions: Permission[]): Promise<void>
  async deactivateMember(memberId: string): Promise<void>
  
  // 권한 관리
  async checkPermission(memberId: string, permission: string): Promise<boolean>
  async getRolePermissions(role: MemberRole): Promise<Permission[]>
}

// OrganizationService.ts 완성
class OrganizationService {
  // 조직 정보 관리
  async updateOrganizationInfo(orgId: string, data: UpdateOrganizationRequest): Promise<void>
  async getOrganizationStats(orgId: string): Promise<OrganizationStats>
  
  // 부서 관리
  async createDepartment(orgId: string, data: CreateDepartmentRequest): Promise<Department>
  async updateDepartment(deptId: string, data: UpdateDepartmentRequest): Promise<void>
  async deleteDepartment(deptId: string): Promise<void>
  
  // 조직 구조
  async getOrganizationTree(orgId: string): Promise<OrganizationTree>
}
```

#### Week 2: 디바이스 관리
```typescript
// DeviceManagementService.ts 구현
class DeviceManagementService {
  // 디바이스 현황
  async getDevices(orgId: string): Promise<Device[]>
  async getDeviceStatus(deviceId: string): Promise<DeviceStatus>
  async updateDeviceStatus(deviceId: string, status: DeviceStatus): Promise<void>
  
  // 디바이스 배치
  async assignDevice(deviceId: string, userId: string): Promise<void>
  async unassignDevice(deviceId: string): Promise<void>
  async getDeviceAssignments(orgId: string): Promise<DeviceAssignment[]>
  
  // 디바이스 모니터링
  async getDeviceHealth(deviceId: string): Promise<DeviceHealth>
  async getDeviceUsageStats(orgId: string): Promise<DeviceUsageStats>
}
```

---

### **👥 3단계: 사용자 관리 시스템 (1주)**

#### 🎯 목표
MEASUREMENT_SUBJECT (측정 대상자) 관리 시스템 구현 - B2B 서비스의 핵심

#### 주요 기능
```typescript
// UserManagementService.ts 구현
class UserManagementService {
  // 간편 등록 시스템
  async registerMeasurementUser(data: {
    organizationId: string;
    displayName: string;
    birthDate: Date;
    phoneNumber: string;
    gender: 'MALE' | 'FEMALE' | 'OTHER';
    department?: string;
    employeeId?: string;
  }): Promise<MeasurementUser>
  
  // 대량 등록 (CSV)
  async bulkRegisterUsers(csvData: string, orgId: string): Promise<BulkRegistrationResult>
  async validateCSVData(csvData: string): Promise<ValidationResult>
  
  // 중복 확인
  async checkDuplicateUser(criteria: {
    organizationId: string;
    phoneNumber?: string;
    employeeId?: string;
  }): Promise<DuplicateCheckResult>
  
  // 측정 이력 관리
  async getMeasurementHistory(userId: string): Promise<MeasurementSession[]>
  async createMeasurementSession(userId: string, deviceId: string): Promise<MeasurementSession>
}
```

#### UI 컴포넌트
- [ ] `UserList.tsx` - 사용자 목록 (페이지네이션, 검색, 필터)
- [ ] `UserRegistration.tsx` - 간편 등록 폼
- [ ] `BulkUserUpload.tsx` - CSV 대량 등록
- [ ] `UserDetail.tsx` - 사용자 상세 정보 및 측정 이력
- [ ] `MeasurementHistory.tsx` - 측정 이력 관리

---

### **🎛️ 4단계: 시스템 관리자 고급 기능 (1주)**

#### 🎯 목표
시스템 전체를 관리하는 슈퍼 어드민 기능 구현

#### 시스템 관리자 전용 기능
```typescript
// SystemAdminService.ts 구현
class SystemAdminService {
  // 전체 조직 관리
  async getAllOrganizations(): Promise<Organization[]>
  async getOrganizationDetails(orgId: string): Promise<OrganizationDetails>
  async updateOrganizationStatus(orgId: string, status: OrganizationStatus): Promise<void>
  
  // 시스템 모니터링
  async getSystemStats(): Promise<SystemStats>
  async getSystemHealth(): Promise<SystemHealth>
  async getErrorLogs(timeRange: TimeRange): Promise<ErrorLog[]>
  
  // 사용량 분석
  async getUsageAnalytics(period: 'daily' | 'weekly' | 'monthly'): Promise<UsageAnalytics>
  async getPerformanceMetrics(): Promise<PerformanceMetrics>
}
```

#### 대시보드 컴포넌트
- [ ] `SystemDashboard.tsx` - 전체 시스템 현황
- [ ] `OrganizationManagement.tsx` - 전체 조직 관리
- [ ] `SystemMonitoring.tsx` - 시스템 모니터링
- [ ] `UsageAnalytics.tsx` - 사용량 분석
- [ ] `SystemSettings.tsx` - 시스템 설정

---

## 🏗️ 기술적 구현 세부사항

### 1. 사용자 타입별 접근 제어

#### 권한 매트릭스
| 기능 | SYSTEM_ADMIN | ORGANIZATION_ADMIN | ORGANIZATION_MEMBER | MEASUREMENT_SUBJECT |
|------|--------------|--------------------|--------------------|-------------------|
| 전체 조직 현황 | ✅ | ❌ | ❌ | ❌ |
| 자신 조직 관리 | ✅ | ✅ | ❌ | ❌ |
| 멤버 관리 | ✅ | ✅ (자신 조직만) | ❌ | ❌ |
| 사용자 관리 | ✅ | ✅ (자신 조직만) | ✅ (자신이 측정한 사용자만) | ❌ |
| 디바이스 관리 | ✅ | ✅ (자신 조직만) | ❌ | ❌ |
| 크레딧 관리 | ✅ | ✅ (자신 조직만) | ❌ | ❌ |
| AI 리포트 생성 | ✅ | ✅ (자신 조직만) | ✅ (자신이 측정한 사용자만) | ❌ |

#### 데이터 접근 필터링
```typescript
// 조직별 데이터 접근 제어
const getFilteredData = async (userType: UserType, organizationId?: string) => {
  switch (userType) {
    case 'SYSTEM_ADMIN':
      return getAllData(); // 전체 데이터 접근
    case 'ORGANIZATION_ADMIN':
      return getOrganizationData(organizationId); // 자신 조직만
    case 'ORGANIZATION_MEMBER':
      return getMemberData(userId, organizationId); // 자신이 측정한 데이터만
    default:
      throw new Error('접근 권한이 없습니다.');
  }
};
```

### 2. 서비스 아키텍처

#### BaseService 상속 구조
```typescript
// 모든 서비스가 상속받는 기본 클래스
abstract class BaseService {
  protected cache: ServiceCache;
  protected logger: Logger;
  protected validator: DataValidator;
  
  // 공통 메서드들
  protected async handleError(error: any, context: string): Promise<never>
  protected async validateInput<T>(data: T, schema: ValidationSchema): Promise<T>
  protected async checkPermission(userId: string, permission: string): Promise<boolean>
}

// 구체적인 서비스들
class MemberManagementService extends BaseService { ... }
class OrganizationService extends BaseService { ... }
class DeviceManagementService extends BaseService { ... }
class UserManagementService extends BaseService { ... }
```

### 3. 데이터베이스 구조

#### 핵심 컬렉션
```typescript
// Firestore 컬렉션 구조
users: {
  // SYSTEM_ADMIN, ORGANIZATION_ADMIN, ORGANIZATION_MEMBER, MEASUREMENT_SUBJECT
  userType: UserType;
  organizationId?: string;
  permissions: string[];
}

organizations: {
  adminUserId: string;
  creditBalance: number;
  status: OrganizationStatus;
  settings: OrganizationSettings;
}

organizationMembers: {
  userId: string;
  organizationId: string;
  role: MemberRole;
  permissions: Permission[];
  status: MemberStatus;
}

devices: {
  organizationId: string;
  status: DeviceStatus;
  assignedTo?: string;
  lastMaintenance: Date;
}

measurementSessions: {
  subjectId: string;
  measuredBy: string; // ORGANIZATION_MEMBER ID
  organizationId: string;
  deviceId: string;
  data: MeasurementData;
}
```

---

## 📋 구현 체크리스트

### ✅ 1단계: 시스템/조직 관리자 분기 (1주)
- [ ] OrganizationAdminApp.tsx userType 기반 분기 구현
- [ ] SystemAdminDashboard.tsx 생성
- [ ] 권한 기반 라우팅 가드 구현
- [ ] 메뉴 구조 분리 (시스템 vs 조직)
- [ ] 데이터 접근 권한 체크 로직

### ⏳ 2단계: 핵심 서비스 완성 (2주)
- [ ] MemberManagementService.ts 완성
- [ ] OrganizationService.ts 완성  
- [ ] DeviceManagementService.ts 구현
- [ ] 이메일 초대 시스템 구현
- [ ] 권한 관리 시스템 구현

### ⏳ 3단계: 사용자 관리 (1주)
- [ ] UserManagementService.ts 구현
- [ ] 간편 등록 시스템 (이름+생년월일+전화번호)
- [ ] CSV 대량 등록 기능
- [ ] 중복 확인 로직
- [ ] 측정 이력 관리

### ⏳ 4단계: 시스템 관리자 기능 (1주)
- [ ] SystemAdminService.ts 구현
- [ ] 전체 조직 모니터링
- [ ] 시스템 통계 및 분석
- [ ] 사용량 분석 도구
- [ ] 시스템 설정 관리

---

## 🎯 성공 지표

### 기술적 지표
- **시스템 응답시간**: 500ms 이내
- **페이지 로딩시간**: 2초 이내  
- **데이터 동기화**: 실시간
- **에러율**: 1% 미만

### 사용성 지표
- **작업 완료율**: 95% 이상
- **사용자 만족도**: 4.5/5.0 이상
- **관리 작업 시간**: 기존 대비 50% 단축

### 비즈니스 지표
- **조직 온보딩 시간**: 1일 이내
- **사용자 등록 완료율**: 90% 이상
- **디바이스 활용률**: 80% 이상

---

## 🚨 리스크 관리

### 기술적 리스크
- **권한 관리 복잡성** → 단계별 구현으로 복잡도 관리
- **데이터 동기화 이슈** → Firebase 실시간 업데이트 활용
- **성능 최적화** → 캐싱 전략 및 페이지네이션 적용

### 일정 리스크  
- **scope creep** → 명확한 단계별 목표 설정
- **의존성 문제** → 병렬 개발 가능한 작업 분리
- **테스트 부족** → 각 단계별 테스트 포함

---

## 📅 다음 액션 아이템

### 즉시 시작: 1단계 작업
1. **OrganizationAdminApp.tsx 분석 및 수정**
2. **사용자 타입별 메뉴 구조 설계**  
3. **SystemAdminDashboard 컴포넌트 생성**
4. **권한 기반 라우팅 구현**

### 준비 작업
1. **서비스 클래스 인터페이스 정의**
2. **타입 정의 완성 (organization.ts, member.ts)**
3. **에러 핸들링 전략 수립**

---

**🎯 최종 목표**: 4주 내에 실제 운영 가능한 Mind Breeze AI B2B 서비스 MVP 완성 