import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '../../../components/ui/card';
import { Button } from '../../../components/ui/button';
import { Badge } from '../../../components/ui/badge';
import { 
  Download, 
  ArrowLeft, 
  Calendar, 
  User, 
  Briefcase, 
  Heart, 
  Brain, 
  Zap,
  FileText,
  CheckCircle,
  AlertCircle,
  Clock,
  ChevronDown,
  ChevronUp,
  Activity,
  Target,
  Shield,
  BarChart3,
  Users,
  TrendingUp,
  Flame,
  AlertTriangle,
  Loader2
} from 'lucide-react';
import { StoredReport } from '../services/ReportStorage';
import PDFReportService from '../services/PDFReportService';
import { toast } from 'sonner';
import { AIAnalysisMarkdownRenderer } from './AIAnalysisMarkdownRenderer';
import { GeminiAIService } from '../services/GeminiAIService';
import DetailedAnalysisSection from './DetailedAnalysisSection';
import OverallHealthReport from './report_segments/OverallHealthReport';
import EEGPPGDetailAnalysisReport from './report_segments/EEGPPGDetailAnalysisReport';
import MentalHealthRiskReport from './report_segments/MentalHealthRiskReport';

interface ReportDetailViewerProps {
  report: StoredReport;
  onBack: () => void;
  className?: string;
  
  // ğŸ†• ì¦‰ì‹œ ë¶„ì„ìš© ì¶”ê°€ ê¸°ëŠ¥
  isCurrentAnalysis?: boolean; // ì¦‰ì‹œ ë¶„ì„ vs ì €ì¥ëœ ë¦¬í¬íŠ¸ êµ¬ë¶„
  showSaveButton?: boolean; // ì €ì¥ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
  showShareButton?: boolean; // ê³µìœ  ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
  onSave?: () => void; // ì €ì¥ ì½œë°±
  onShare?: () => void; // ê³µìœ  ì½œë°±
  
  // ğŸ†• ì¶”ê°€ ì•¡ì…˜ ë²„íŠ¼ë“¤
  showEEGButton?: boolean; // EEG ìƒì„¸ ë¶„ì„ ë²„íŠ¼
  showPPGButton?: boolean; // PPG ìƒì„¸ ë¶„ì„ ë²„íŠ¼
  onViewEEGAnalysis?: () => void; // EEG ìƒì„¸ ë¶„ì„ ì½œë°±
  onViewPPGAnalysis?: () => void; // PPG ìƒì„¸ ë¶„ì„ ì½œë°±
  
  // ğŸ†• ìƒíƒœ í‘œì‹œ
  isSaving?: boolean; // ì €ì¥ ì¤‘ ìƒíƒœ
  saveSuccess?: boolean; // ì €ì¥ ì„±ê³µ ìƒíƒœ
}

interface ExpandedSections {
  overview: boolean;
  analysis: boolean;
  recommendations: boolean;
  mentalHealthRisk: boolean;
  medicalRiskAnalysis: boolean;
}

interface MentalHealthComprehensiveAnalysis {
  comprehensiveInterpretation: string;
  individualMetricsInterpretation: {
    focusIndex: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    relaxationIndex: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    stressIndex: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    cognitiveLoad: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    emotionalStability: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    hemisphericBalance: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    totalPower: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
  };
  ageSpecificAnalysis: {
    ageGroup: string;
    typicalCharacteristics: string;
    currentComparison: string;
    riskFactors: string[];
    strengths: string[];
  };
  genderSpecificAnalysis: {
    gender: string;
    brainPatternCharacteristics: string;
    hormonalInfluence: string;
    mentalHealthPatterns: string;
    managementPoints: string[];
  };
  occupationalAnalysis: {
    occupation: string;
    workRequirements: string;
    stressFactors: string[];
    brainFunctionMatch: string;
    workplaceRisks: string[];
    adaptationStrategies: string[];
  };
  mentalHealthRiskAssessment: {
    primaryRisks: string[];
    protectiveFactors: string[];
    immediateAttention: string[];
    longTermMonitoring: string[];
  };
  personalizedRecommendations: {
    immediate: string[];
    shortTerm: string[];
    longTerm: string[];
    occupationSpecific: string[];
  };
}

interface PhysicalHealthComprehensiveAnalysis {
  comprehensiveInterpretation: string;
  individualMetricsInterpretation: {
    heartRate: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    rmssd: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    sdnn: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    spo2: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
    lfHfRatio: {
      value: number;
      normalRange: string;
      status: string;
      interpretation: string;
      personalizedAdvice: string;
    };
  };
  ageSpecificAnalysis: {
    ageGroup: string;
    typicalCharacteristics: string;
    currentComparison: string;
    riskFactors: string[];
    strengths: string[];
  };
  genderSpecificAnalysis: {
    gender: string;
    cardiovascularCharacteristics: string;
    hormonalInfluence: string;
    healthPatterns: string;
    managementPoints: string[];
  };
  occupationalAnalysis: {
    occupation: string;
    workRequirements: string;
    stressFactors: string[];
    cardiovascularMatch: string;
    workplaceRisks: string[];
    adaptationStrategies: string[];
  };
  cardiovascularRiskAssessment: {
    primaryRisks: string[];
    protectiveFactors: string[];
    immediateAttention: string[];
    longTermMonitoring: string[];
  };
  personalizedRecommendations: {
    immediate: string[];
    shortTerm: string[];
    longTerm: string[];
    occupationSpecific: string[];
  };
}

const ReportDetailViewer: React.FC<ReportDetailViewerProps> = ({
  report,
  onBack,
  className = '',
  
  // ğŸ†• ì¦‰ì‹œ ë¶„ì„ìš© ì¶”ê°€ ê¸°ëŠ¥
  isCurrentAnalysis = false,
  showSaveButton = false,
  showShareButton = false,
  onSave,
  onShare,
  
  // ğŸ†• ì¶”ê°€ ì•¡ì…˜ ë²„íŠ¼ë“¤
  showEEGButton = false,
  showPPGButton = false,
  onViewEEGAnalysis,
  onViewPPGAnalysis,
  
  // ğŸ†• ìƒíƒœ í‘œì‹œ
  isSaving = false,
  saveSuccess = false
}) => {
  const [downloadingPDF, setDownloadingPDF] = useState(false);
  const [expandedSections, setExpandedSections] = useState<ExpandedSections>({
    overview: true,
    analysis: false,
    recommendations: false,
    mentalHealthRisk: false,
    medicalRiskAnalysis: false
  });
  const [mentalHealthComprehensive, setMentalHealthComprehensive] = useState<MentalHealthComprehensiveAnalysis | null>(null);
  const [loadingComprehensive, setLoadingComprehensive] = useState(false);
  const [physicalHealthComprehensive, setPhysicalHealthComprehensive] = useState<PhysicalHealthComprehensiveAnalysis | null>(null);
  const [loadingPhysicalComprehensive, setLoadingPhysicalComprehensive] = useState(false);
  const [stressComprehensive, setStressComprehensive] = useState<{
    comprehensiveInterpretation: string;
    ageSpecificAnalysis: {
      ageGroup: string;
      typicalCharacteristics: string;
      currentComparison: string;
      riskFactors: string[];
      strengths: string[];
    };
    genderSpecificAnalysis: {
      gender: string;
      stressPatternCharacteristics: string;
      hormonalInfluence: string;
      stressManagementPatterns: string;
      managementPoints: string[];
    };
    occupationalAnalysis: {
      occupation: string;
      workRequirements: string;
      stressFactors: string[];
      stressManagementMatch: string;
      workplaceRisks: string[];
      adaptationStrategies: string[];
    };
  } | null>(null);
  const [loadingStressComprehensive, setLoadingStressComprehensive] = useState(false);

  const { personalInfo, analysisResult } = report;

  // ë‡ŒíŒŒ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ
  useEffect(() => {
    // ğŸ”§ ì¦‰ì‹œ ë¶„ì„ì¸ ê²½ìš°ì—ë§Œ AI ë¶„ì„ ì‹¤í–‰
    if (!isCurrentAnalysis) {
      console.log('ğŸ“‹ ì €ì¥ëœ ë¦¬í¬íŠ¸ - ë‡ŒíŒŒ AI ë¶„ì„ ê±´ë„ˆëœ€');
      return;
    }

    const loadMentalHealthComprehensive = async () => {
      if (!analysisResult?.detailedAnalysis?.mentalHealth) return;
      
      try {
        setLoadingComprehensive(true);
        
        // detailedAnalysis.mentalHealthë¥¼ MentalHealthReport í˜•íƒœë¡œ ë³€í™˜
        const mentalHealthReport = {
          score: analysisResult.detailedAnalysis.mentalHealth.score,
          status: analysisResult.detailedAnalysis.mentalHealth.status,
          analysis: analysisResult.detailedAnalysis.mentalHealth.analysis,
          keyMetrics: analysisResult.detailedAnalysis.mentalHealth.keyMetrics,
          recommendations: analysisResult.detailedAnalysis.mentalHealth.recommendations || [],
          concerns: [] // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ ë°°ì—´ ì„¤ì •
        };
        
        const comprehensiveAnalysis = await GeminiAIService.generateMentalHealthComprehensiveInterpretation(
          personalInfo,
          report.measurementData,
          mentalHealthReport
        );
        setMentalHealthComprehensive(comprehensiveAnalysis);
      } catch (error) {
        console.error('ë‡ŒíŒŒ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ ì‹¤íŒ¨:', error);
        toast.error('ë‡ŒíŒŒ ë¶„ì„ ì¢…í•© í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoadingComprehensive(false);
      }
    };

    loadMentalHealthComprehensive();
  }, [personalInfo, report.measurementData, analysisResult?.detailedAnalysis?.mentalHealth, isCurrentAnalysis]);

  // ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ
  useEffect(() => {
    // ğŸ”§ ì¦‰ì‹œ ë¶„ì„ì¸ ê²½ìš°ì—ë§Œ AI ë¶„ì„ ì‹¤í–‰
    if (!isCurrentAnalysis) {
      console.log('ğŸ“‹ ì €ì¥ëœ ë¦¬í¬íŠ¸ - ë§¥íŒŒ AI ë¶„ì„ ê±´ë„ˆëœ€');
      return;
    }

    const loadPhysicalHealthComprehensive = async () => {
      if (!analysisResult?.detailedAnalysis?.physicalHealth) return;
      
      try {
        setLoadingPhysicalComprehensive(true);
        
        // detailedAnalysis.physicalHealthë¥¼ PhysicalHealthReport í˜•íƒœë¡œ ë³€í™˜
        const physicalHealthReport = {
          score: analysisResult.detailedAnalysis.physicalHealth.score,
          status: analysisResult.detailedAnalysis.physicalHealth.status,
          analysis: analysisResult.detailedAnalysis.physicalHealth.analysis,
          keyMetrics: analysisResult.detailedAnalysis.physicalHealth.keyMetrics,
          recommendations: analysisResult.detailedAnalysis.physicalHealth.recommendations || [],
          concerns: [] // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ ë°°ì—´ ì„¤ì •
        };
        
        const comprehensiveAnalysis = await GeminiAIService.generatePhysicalHealthComprehensiveInterpretation(
          personalInfo,
          report.measurementData,
          physicalHealthReport
        );
        setPhysicalHealthComprehensive(comprehensiveAnalysis);
      } catch (error) {
        console.error('ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ ì‹¤íŒ¨:', error);
        toast.error('ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoadingPhysicalComprehensive(false);
      }
    };

    loadPhysicalHealthComprehensive();
  }, [personalInfo, report.measurementData, analysisResult?.detailedAnalysis?.physicalHealth, isCurrentAnalysis]);

  // ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ
  useEffect(() => {
    // ğŸ”§ ì¦‰ì‹œ ë¶„ì„ì¸ ê²½ìš°ì—ë§Œ AI ë¶„ì„ ì‹¤í–‰
    if (!isCurrentAnalysis) {
      console.log('ğŸ“‹ ì €ì¥ëœ ë¦¬í¬íŠ¸ - ìŠ¤íŠ¸ë ˆìŠ¤ AI ë¶„ì„ ê±´ë„ˆëœ€');
      return;
    }

    const loadStressComprehensive = async () => {
      if (!analysisResult?.detailedAnalysis?.stressLevel) return;
      
      try {
        setLoadingStressComprehensive(true);
        
        // ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° ì¤€ë¹„
        const stressReport = {
          score: analysisResult.detailedAnalysis.stressLevel.score,
          level: analysisResult.detailedAnalysis.stressLevel.level,
          eegStressIndex: report.measurementData.eegMetrics.stressIndex?.value || 0,
          heartRate: report.measurementData.ppgMetrics.heartRate?.value || 0,
          rmssd: report.measurementData.ppgMetrics.rmssd?.value || 0,
          lfHfRatio: report.measurementData.ppgMetrics.lfHfRatio?.value || 0,
          relaxationIndex: report.measurementData.eegMetrics.relaxationIndex?.value || 0
        };
        
        // ì„ì‹œë¡œ ì •ì  ìŠ¤íŠ¸ë ˆìŠ¤ ì¢…í•© í•´ì„ ìƒì„± (í–¥í›„ AI ì„œë¹„ìŠ¤ ì—°ë™ ì˜ˆì •)
        const comprehensiveAnalysis = {
          comprehensiveInterpretation: `**${personalInfo.name}ë‹˜ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœ ì¢…í•© ë¶„ì„**\n\n` +
            `ì¸¡ì • ê²°ê³¼ ì „ë°˜ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ì ìˆ˜ëŠ” ${stressReport.score}ì ìœ¼ë¡œ ${stressReport.level} ìƒíƒœë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.\n\n` +
            `**ì£¼ìš” ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ ë¶„ì„:**\n\n` +
            `â€¢ **ë‡ŒíŒŒ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜**: ${stressReport.eegStressIndex.toFixed(2)} - ${stressReport.eegStressIndex >= 3.0 && stressReport.eegStressIndex <= 4.0 ? 'ì •ìƒ ë²”ìœ„ ë‚´ì˜ ì ì ˆí•œ ì •ì‹ ì  ê¸´ì¥ ìƒíƒœ' : stressReport.eegStressIndex > 4.0 ? 'ë†’ì€ ì •ì‹ ì  ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœë¡œ ì£¼ì˜ í•„ìš”' : 'ë‚®ì€ ì •ì‹ ì  í™œì„±ë„ë¡œ ê°ì„± ìƒíƒœ ê°œì„  í•„ìš”'}\n\n` +
            `â€¢ **ììœ¨ì‹ ê²½ ê· í˜•**: LF/HF ë¹„ìœ¨ ${stressReport.lfHfRatio.toFixed(2)} - ${stressReport.lfHfRatio >= 1.0 && stressReport.lfHfRatio <= 10.0 ? 'êµê°ì‹ ê²½ê³¼ ë¶€êµê°ì‹ ê²½ì˜ ê· í˜•ì´ ì ì ˆíˆ ìœ ì§€ë¨' : 'ììœ¨ì‹ ê²½ ë¶ˆê· í˜• ìƒíƒœë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ í•„ìš”'}\n\n` +
            `â€¢ **ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µë ¥**: RMSSD ${stressReport.rmssd.toFixed(0)}ms - ${stressReport.rmssd >= 20 && stressReport.rmssd <= 50 ? 'ì–‘í˜¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥' : stressReport.rmssd > 50 ? 'ìš°ìˆ˜í•œ ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥' : 'ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥ ê°œì„  í•„ìš”'}\n\n` +
            `â€¢ **ì‹¬ë°•ìˆ˜ ë°˜ì‘**: ${stressReport.heartRate.toFixed(0)}BPM - ${stressReport.heartRate >= 60 && stressReport.heartRate <= 100 ? 'ì •ìƒ ë²”ìœ„ì˜ ì•ˆì •ì ì¸ ì‹¬ë°•ìˆ˜' : stressReport.heartRate > 100 ? 'ë†’ì€ ì‹¬ë°•ìˆ˜ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ ì¦ê°€' : 'ë‚®ì€ ì‹¬ë°•ìˆ˜'}\n\n` +
            `**ê°œì¸ íŠ¹ì„± ê³ ë ¤ì‚¬í•­:**\n\n` +
            `${personalInfo.age}ì„¸ ${personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}ì˜ ê²½ìš°, í•´ë‹¹ ì—°ë ¹ëŒ€ì˜ ì¼ë°˜ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ íŒ¨í„´ê³¼ ë¹„êµí•˜ì—¬ ${stressReport.score >= 70 ? 'ì–‘í˜¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ìƒíƒœ' : 'ê°œì„ ì´ í•„ìš”í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ìƒíƒœ'}ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.\n\n` +
            `**ì¢…í•© ê¶Œì¥ì‚¬í•­:**\n\n` +
            `í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœë¥¼ ê³ ë ¤í•  ë•Œ, ${stressReport.score >= 80 ? 'í˜„ì¬ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ì‹ì„ ìœ ì§€í•˜ë˜ ì˜ˆë°©ì  ê´€ë¦¬ì— ì§‘ì¤‘' : stressReport.score >= 60 ? 'ì¼ë¶€ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ ê°œì„ ì„ ìœ„í•œ ë§ì¶¤í˜• ê´€ë¦¬ ë°©ì•ˆ ì ìš©' : 'ì¢…í•©ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ì „ëµ ìˆ˜ë¦½ ë° ì „ë¬¸ì  ë„ì›€ ê³ ë ¤'}í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.`,
          ageSpecificAnalysis: {
            ageGroup: `${personalInfo.age}ì„¸`,
            typicalCharacteristics: `${personalInfo.age}ì„¸ ì—°ë ¹ëŒ€ëŠ” ${personalInfo.gender === 'male' ? 'ì§ì—…ì  ì±…ì„ê³¼ ì‚¬íšŒì  ì—­í•  ì¦ê°€ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì¤‘ìš”í•œ' : 'ë‹¤ì–‘í•œ ìƒí™œ ë³€í™”ì™€ í˜¸ë¥´ëª¬ ë³€í™”ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ì ì‘ì´ í•„ìš”í•œ'} ì‹œê¸°ì…ë‹ˆë‹¤.`,
            currentComparison: `í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€ í•´ë‹¹ ì—°ë ¹ëŒ€ í‰ê·  ëŒ€ë¹„ ${stressReport.score >= 70 ? 'ì–‘í˜¸í•œ' : 'ê°œì„ ì´ í•„ìš”í•œ'} ìƒíƒœì…ë‹ˆë‹¤.`,
            riskFactors: stressReport.score < 60 ? ['ë§Œì„± ìŠ¤íŠ¸ë ˆìŠ¤ ì¶•ì ', 'ììœ¨ì‹ ê²½ ë¶ˆê· í˜•', 'ìˆ˜ë©´ ì§ˆ ì €í•˜'] : ['ì¼ì‹œì  ìŠ¤íŠ¸ë ˆìŠ¤ ì¦ê°€'],
            strengths: stressReport.score >= 70 ? ['ì ì ˆí•œ ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‘ ëŠ¥ë ¥', 'ì•ˆì •ì ì¸ ììœ¨ì‹ ê²½ ê¸°ëŠ¥'] : ['ê°œì„  ê°€ëŠ¥ì„± ë†’ìŒ']
          },
          genderSpecificAnalysis: {
            gender: personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±',
            stressPatternCharacteristics: personalInfo.gender === 'male' ? 'ë‚¨ì„±ì€ ì¼ë°˜ì ìœ¼ë¡œ ë¬¸ì œ í•´ê²° ì¤‘ì‹¬ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‘ íŒ¨í„´ì„ ë³´ì…ë‹ˆë‹¤.' : 'ì—¬ì„±ì€ ì¼ë°˜ì ìœ¼ë¡œ ê°ì •ì  ì§€ì§€ì™€ ì‚¬íšŒì  ì—°ê²°ì„ í†µí•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ íŒ¨í„´ì„ ë³´ì…ë‹ˆë‹¤.',
            hormonalInfluence: personalInfo.gender === 'male' ? 'í…ŒìŠ¤í† ìŠ¤í…Œë¡  ìˆ˜ì¤€ì´ ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.' : 'ì—ìŠ¤íŠ¸ë¡œê²ê³¼ í”„ë¡œê²ŒìŠ¤í…Œë¡  ë³€í™”ê°€ ìŠ¤íŠ¸ë ˆìŠ¤ ë¯¼ê°ë„ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.',
            stressManagementPatterns: personalInfo.gender === 'male' ? 'ì‹ ì²´ í™œë™ê³¼ ëª©í‘œ ì§€í–¥ì  í™œë™ì„ í†µí•œ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œê°€ íš¨ê³¼ì ì…ë‹ˆë‹¤.' : 'ì‚¬íšŒì  ì§€ì§€ì™€ ê°ì • í‘œí˜„ì„ í†µí•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.',
            managementPoints: personalInfo.gender === 'male' ? ['ê·œì¹™ì ì¸ ìš´ë™', 'ëª…í™•í•œ ëª©í‘œ ì„¤ì •', 'ì·¨ë¯¸ í™œë™'] : ['ì‚¬íšŒì  ì—°ê²°', 'ê°ì • í‘œí˜„', 'ìê¸° ëŒë´„']
          },
          occupationalAnalysis: {
            occupation: personalInfo.occupation,
            workRequirements: `${personalInfo.occupation} ì§êµ°ì˜ íŠ¹ì„±ìƒ ë‹¤ì–‘í•œ ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸ì— ë…¸ì¶œë˜ì–´ ìˆìŠµë‹ˆë‹¤.`,
            stressFactors: personalInfo.occupation === 'developer' ? ['ì¥ì‹œê°„ ì»´í“¨í„° ì‘ì—…', 'ì—…ë¬´ ì••ë°•', 'ê¸°ìˆ  ë³€í™” ì ì‘'] : 
                          personalInfo.occupation === 'manager' ? ['ì˜ì‚¬ê²°ì • ë¶€ë‹´', 'íŒ€ ê´€ë¦¬', 'ì„±ê³¼ ì••ë°•'] : 
                          ['ì—…ë¬´ ì••ë°•', 'ëŒ€ì¸ê´€ê³„', 'í™˜ê²½ ë³€í™”'],
            stressManagementMatch: `í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€ ì—…ë¬´ ìˆ˜í–‰ì— ${stressReport.score >= 70 ? 'ì í•©í•œ' : 'ê°œì„ ì´ í•„ìš”í•œ'} ìƒíƒœì…ë‹ˆë‹¤.`,
            workplaceRisks: stressReport.score < 60 ? ['ì—…ë¬´ íš¨ìœ¨ì„± ì €í•˜', 'ì˜ì‚¬ê²°ì • ëŠ¥ë ¥ ê°ì†Œ', 'ëŒ€ì¸ê´€ê³„ ë¬¸ì œ'] : ['ì¼ì‹œì  ìŠ¤íŠ¸ë ˆìŠ¤ ì¦ê°€'],
            adaptationStrategies: ['ì—…ë¬´ ìš°ì„ ìˆœìœ„ ì„¤ì •', 'íœ´ì‹ ì‹œê°„ í™•ë³´', 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ê¸°ë²• í™œìš©']
          }
        };
        setStressComprehensive(comprehensiveAnalysis);
      } catch (error) {
        console.error('ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„ ë¡œë“œ ì‹¤íŒ¨:', error);
        toast.error('ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoadingStressComprehensive(false);
      }
    };

    loadStressComprehensive();
  }, [personalInfo, report.measurementData, analysisResult?.detailedAnalysis?.stressLevel, isCurrentAnalysis]);

  const handleDownloadPDF = async () => {
    try {
      setDownloadingPDF(true);
      const pdfService = PDFReportService.getInstance();
      const pdfBlob = await pdfService.generatePDFFromStoredReport(report);
      
      // PDF ë‹¤ìš´ë¡œë“œ
      const url = URL.createObjectURL(pdfBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `AIê±´ê°•ë¦¬í¬íŠ¸_${report.personalInfo.name}_${new Date(report.timestamp).toLocaleDateString('ko-KR').replace(/\./g, '')}.pdf`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      toast.success('PDFê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('PDF ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
      toast.error('PDF ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setDownloadingPDF(false);
    }
  };

  const formatDate = (timestamp: number) => {
    const date = new Date(timestamp);
    return date.toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return 'text-green-600';
    if (score >= 60) return 'text-blue-600';
    if (score >= 40) return 'text-orange-600';
    return 'text-red-600';
  };

  const getScoreBadgeColor = (score: number) => {
    if (score >= 80) return 'bg-green-100 text-green-700 border-green-300';
    if (score >= 60) return 'bg-blue-100 text-blue-700 border-blue-300';
    if (score >= 40) return 'bg-orange-100 text-orange-700 border-orange-300';
    return 'bg-red-100 text-red-700 border-red-300';
  };

  const getOccupationLabel = (occupation: string) => {
    const labels: { [key: string]: string } = {
      'teacher': 'êµì‚¬',
      'military_medic': 'ì˜ë¬´ë³‘ì‚¬',
      'military_career': 'ì§ì—…êµ°ì¸',
      'elementary': 'ì´ˆë“±í•™ìƒ',
      'middle_school': 'ì¤‘í•™ìƒ',
      'high_school': 'ê³ ë“±í•™ìƒ',
      'university': 'ëŒ€í•™ìƒ',
      'housewife': 'ì „ì—…ì£¼ë¶€',
      'parent': 'í•™ë¶€ëª¨',
      'firefighter': 'ì†Œë°©ê³µë¬´ì›',
      'police': 'ê²½ì°°ê³µë¬´ì›',
      'developer': 'ê°œë°œì',
      'designer': 'ë””ìì´ë„ˆ',
      'office_worker': 'ì¼ë°˜ ì‚¬ë¬´ì§',
      'manager': 'ê´€ë¦¬ì',
      'general_worker': 'ì¼ë°˜ ì§ì¥ì¸',
      'entrepreneur': 'ì‚¬ì—…ê°€',
      'other': 'ê·¸ì™¸'
    };
    return labels[occupation] || occupation;
  };

  // 5ë‹¨ê³„ ë¶„í¬ í‘œì‹œ ì»´í¬ë„ŒíŠ¸
  const ScoreDistributionBar = ({ score, label, className = '' }: { score: number; label: string; className?: string }) => {
    const getScoreLevel = (score: number) => {
      if (score < 5) return { level: 'ìœ„í—˜', color: 'text-red-600' };
      if (score < 25) return { level: 'ê²½ê³„', color: 'text-orange-600' };
      if (score < 75) return { level: 'ë³´í†µ', color: 'text-yellow-600' };
      if (score < 95) return { level: 'ì–‘í˜¸', color: 'text-green-600' };
      return { level: 'ìš°ìˆ˜', color: 'text-blue-600' };
    };

    const { level, color } = getScoreLevel(score);

    return (
      <div className={`space-y-3 ${className}`}>
        <div className="flex items-center justify-between">
          <span className="text-base font-semibold text-gray-700">{label}</span>
          <span className={`text-xl font-bold ${color}`}>
            {score.toFixed(1)}/100
          </span>
        </div>
        <div className="space-y-2">
          <div className="relative">
            {/* ì „ì²´ êµ¬ê°„ ìƒ‰ìƒ í‘œì‹œ */}
            <div className="w-full h-4 rounded-lg overflow-hidden bg-gradient-to-r from-red-500 via-orange-400 via-yellow-400 via-green-400 to-blue-500">
              {/* êµ¬ê°„ ê²½ê³„ì„  */}
              <div className="absolute top-0 left-[5%] w-px h-4 bg-white opacity-70"></div>
              <div className="absolute top-0 left-[25%] w-px h-4 bg-white opacity-70"></div>
              <div className="absolute top-0 left-[75%] w-px h-4 bg-white opacity-70"></div>
              <div className="absolute top-0 left-[95%] w-px h-4 bg-white opacity-70"></div>
            </div>
            
            {/* í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ë¼ì¸ */}
            <div 
              className="absolute top-0 w-0.5 h-4 bg-gray-900 rounded-sm transition-all duration-500"
              style={{ left: `${score}%`, transform: 'translateX(-50%)' }}
            />
            
            {/* í˜„ì¬ ìœ„ì¹˜ í‘œì‹œì  */}
            <div 
              className="absolute top-1/2 w-3 h-3 bg-white border-2 border-gray-900 rounded-full transition-all duration-500"
              style={{ left: `${score}%`, transform: 'translate(-50%, -50%)' }}
            />
            
            {/* ì ìˆ˜ ë° ìƒíƒœ íˆ´íŒ */}
            <div 
              className="absolute -top-12 bg-gray-800 text-white px-2 py-1 rounded text-xs font-semibold transition-all duration-500 whitespace-nowrap text-center"
              style={{ left: `${score}%`, transform: 'translateX(-50%)' }}
            >
              <div>{score.toFixed(1)}ì </div>
              <div>{level}</div>
              <div className="absolute top-full left-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-800" style={{ transform: 'translateX(-50%)' }}></div>
            </div>
          </div>
          
          {/* êµ¬ê°„ ë¼ë²¨ */}
          <div className="flex justify-between text-sm text-gray-500 font-medium">
            <span>ìœ„í—˜</span>
            <span>ê²½ê³„</span>
            <span>ë³´í†µ</span>
            <span>ì–‘í˜¸</span>
            <span>ìš°ìˆ˜</span>
          </div>
        </div>
        <div className={`text-base font-semibold ${color}`}>
          ìƒíƒœ: {level}
        </div>
      </div>
    );
  };

  // ë‡ŒíŒŒ ì§€í‘œ 270ë„ ê²Œì´ì§€ ê·¸ë˜í”„ ì»´í¬ë„ŒíŠ¸
  const MentalHealthRiskChart = ({ value, label }: { 
    value: number; 
    label: string; 
  }) => {
    // ì •ì‹ ê±´ê°• ìœ„í—˜ë„ êµ¬ê°„: 0-30 (ì •ìƒ), 31-50 (ê²½ê³„), 51-100 (ìœ„í—˜)
    const totalRange = 100;
    const normalMax = 30;
    const borderlineMax = 50;
    
    // 200ë„ ê°ë„ ê³„ì‚°
    const totalAngle = 200;
    const startAngle = 260;
    
    // ê° êµ¬ê°„ì˜ ê°ë„ ê³„ì‚° (ë¹„ìœ¨ì— ë”°ë¼)
    const normalAngle = (normalMax / totalRange) * totalAngle; // 30% = 60ë„
    const borderlineAngle = ((borderlineMax - normalMax) / totalRange) * totalAngle; // 20% = 40ë„  
    const riskAngle = ((totalRange - borderlineMax) / totalRange) * totalAngle; // 50% = 100ë„
    
    // í˜„ì¬ ê°’ì˜ ê°ë„ ê³„ì‚°
    const currentValueAngle = Math.min(totalAngle, Math.max(0, (value / totalRange) * totalAngle));
    
    // ê·¹ì¢Œí‘œë¥¼ ì§êµì¢Œí‘œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {
      const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
      return {
        x: centerX + (radius * Math.cos(angleInRadians)),
        y: centerY + (radius * Math.sin(angleInRadians))
      };
    };
    
    // í˜¸ ê²½ë¡œ ìƒì„± í•¨ìˆ˜
    const describeArc = (x: number, y: number, radius: number, startAngle: number, endAngle: number) => {
      const start = polarToCartesian(x, y, radius, endAngle);
      const end = polarToCartesian(x, y, radius, startAngle);
      const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
      return [
        "M", start.x, start.y, 
        "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y
      ].join(" ");
    };

    const centerX = 50;
    const centerY = 50;
    const radius = 40;
    
    // ê° êµ¬ê°„ì˜ ê²½ë¡œ ìƒì„± (ì•½ê°„ì”© ê²¹ì¹˜ê²Œ í•˜ì—¬ ê²½ê³„ë¥¼ ì§ì„ ìœ¼ë¡œ ë§Œë“¤ê¸°)
    const normalPath = describeArc(centerX, centerY, radius, startAngle, startAngle + normalAngle + 1);
    const borderlinePath = describeArc(centerX, centerY, radius, startAngle + normalAngle - 1, startAngle + normalAngle + borderlineAngle + 1);
    const riskPath = describeArc(centerX, centerY, radius, startAngle + normalAngle + borderlineAngle - 1, startAngle + totalAngle);
    
    // í˜„ì¬ ê°’ ë§ˆì»¤ ìœ„ì¹˜
    const markerAngle = startAngle + currentValueAngle;
    const markerPos = polarToCartesian(centerX, centerY, radius, markerAngle);
    const markerPosInner = polarToCartesian(centerX, centerY, radius - 12, markerAngle);

    return (
      <div className="relative w-56 h-56 mx-auto">
        <svg className="w-56 h-56" viewBox="0 0 100 100">
          {/* ë°°ê²½ í˜¸ */}
          <path
            d={describeArc(centerX, centerY, radius, startAngle, startAngle + totalAngle)}
            stroke="#f3f4f6"
            strokeWidth="12"
            fill="none"
            strokeLinecap="round"
          />
          
          {/* ì •ìƒ êµ¬ê°„ (ì´ˆë¡ìƒ‰) - ë¨¼ì € ê·¸ë¦¬ê³  ì™¼ìª½ ë round */}
          <path
            d={normalPath}
            stroke="#10b981"
            strokeWidth="12"
            fill="none"
            strokeLinecap="round"
          />
          
          {/* ìœ„í—˜ êµ¬ê°„ (ë¹¨ê°„ìƒ‰) - ë‘ ë²ˆì§¸ë¡œ ê·¸ë¦¬ê³  ì˜¤ë¥¸ìª½ ë round */}
          <path
            d={riskPath}
            stroke="#ef4444"
            strokeWidth="12"
            fill="none"
            strokeLinecap="round"
          />
          
          {/* ê²½ê³„ êµ¬ê°„ (ë…¸ë€ìƒ‰) - ê°€ì¥ ë§ˆì§€ë§‰ì— ê·¸ë¦¬ê³  buttë¡œ ì¤‘ê°„ ê²½ê³„ ë®ì–´ì“°ê¸° */}
          <path
            d={borderlinePath}
            stroke="#eab308"
            strokeWidth="12"
            fill="none"
            strokeLinecap="butt"
          />
          
          {/* í˜„ì¬ ê°’ ë§ˆì»¤ */}
          <g>
            {/* ë§ˆì»¤ ë¼ì¸ */}
            <line
              x1={markerPosInner.x}
              y1={markerPosInner.y}
              x2={markerPos.x}
              y2={markerPos.y}
              stroke="#1f2937"
              strokeWidth="4"
              strokeLinecap="round"
            />
            {/* ë§ˆì»¤ ì  */}
            <circle
              cx={markerPos.x}
              cy={markerPos.y}
              r="4"
              fill="#1f2937"
            />
          </g>
        </svg>
        
        {/* ì¤‘ì•™ ê°’ í‘œì‹œ */}
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center mt-1">
            <div className="text-4xl font-bold text-gray-900 mb-2">
              {value.toFixed(0)}
            </div>
            {/* ìƒíƒœ í‘œì‹œ - Chip í˜•íƒœ */}
            <div className="mt-2">
              <Badge 
                variant="outline" 
                className={
                  value <= 30
                    ? 'bg-green-100 text-green-800 border-green-200' 
                    : value <= 50
                    ? 'bg-yellow-100 text-yellow-800 border-yellow-200'
                    : 'bg-red-100 text-red-800 border-red-200'
                }
              >
                {value <= 30 ? 'ì •ìƒ' : value <= 50 ? 'ê²½ê³„' : 'ìœ„í—˜'}
              </Badge>
            </div>
          </div>
        </div>
        
        {/* ë²”ìœ„ ë¼ë²¨ */}
        <div className="absolute bottom-10 left-0 right-0 flex justify-between text-sm text-gray-500 px-4">
          <span>ì •ìƒ</span>
          <span>ê²½ê³„</span>
          <span>ìœ„í—˜</span>
        </div>
      </div>
    );
  };

  const EEGMetricChart = ({ value, normalRange, label, unit = '', status, customLabels }: { 
    value: number; 
    normalRange: { min: number; max: number }; 
    label: string; 
    unit?: string;
    status: 'low' | 'normal' | 'high';
    customLabels?: { low: string; normal: string; high: string };
  }) => {
    // ì „ì²´ ë²”ìœ„ ê³„ì‚° (ì •ìƒë²”ìœ„ ì•ë’¤ë¡œ ì—¬ìœ ë¶„ ì¶”ê°€)
    const rangeSpan = normalRange.max - normalRange.min;
    const minValue = normalRange.min - rangeSpan * 0.5; // ì •ìƒ ìµœì†Œê°’ë³´ë‹¤ 50% ë‚®ê²Œ
    const maxValue = normalRange.max + rangeSpan * 0.5; // ì •ìƒ ìµœëŒ€ê°’ë³´ë‹¤ 50% ë†’ê²Œ
    
    // 200ë„ ê°ë„ ê³„ì‚°
    const totalAngle = 200; // 200ë„
    const startAngle = 260; // ì‹œì‘ ê°ë„ (ì •ìƒ ë²”ìœ„ ê°€ìš´ë°ê°€ ìœ„ì— ì˜¤ë„ë¡ ì¡°ì •)
    
    // ê° êµ¬ê°„ì˜ ê°ë„ ê³„ì‚°
    const lowRangeAngle = ((normalRange.min - minValue) / (maxValue - minValue)) * totalAngle;
    const normalRangeAngle = ((normalRange.max - normalRange.min) / (maxValue - minValue)) * totalAngle;
    const highRangeAngle = ((maxValue - normalRange.max) / (maxValue - minValue)) * totalAngle;
    
    // í˜„ì¬ ê°’ì˜ ê°ë„ ê³„ì‚°
    const currentValueAngle = Math.min(totalAngle, Math.max(0, ((value - minValue) / (maxValue - minValue)) * totalAngle));
    
    // ê·¹ì¢Œí‘œë¥¼ ì§êµì¢Œí‘œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {
      const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
      return {
        x: centerX + (radius * Math.cos(angleInRadians)),
        y: centerY + (radius * Math.sin(angleInRadians))
      };
    };
    
    // í˜¸ ê²½ë¡œ ìƒì„± í•¨ìˆ˜
    const describeArc = (x: number, y: number, radius: number, startAngle: number, endAngle: number) => {
      const start = polarToCartesian(x, y, radius, endAngle);
      const end = polarToCartesian(x, y, radius, startAngle);
      const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
      return [
        "M", start.x, start.y, 
        "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y
      ].join(" ");
    };

    const centerX = 50;
    const centerY = 50;
    const radius = 40;
    
    // ê° êµ¬ê°„ì˜ ê²½ë¡œ ìƒì„± (ì•½ê°„ì”© ê²¹ì¹˜ê²Œ í•˜ì—¬ ê²½ê³„ë¥¼ ì§ì„ ìœ¼ë¡œ ë§Œë“¤ê¸°)
    const lowPath = describeArc(centerX, centerY, radius, startAngle, startAngle + lowRangeAngle + 1);
    const normalPath = describeArc(centerX, centerY, radius, startAngle + lowRangeAngle - 1, startAngle + lowRangeAngle + normalRangeAngle + 1);
    const highPath = describeArc(centerX, centerY, radius, startAngle + lowRangeAngle + normalRangeAngle - 1, startAngle + totalAngle);
    
    // í˜„ì¬ ê°’ ë§ˆì»¤ ìœ„ì¹˜
    const markerAngle = startAngle + currentValueAngle;
    const markerPos = polarToCartesian(centerX, centerY, radius, markerAngle);
    const markerPosInner = polarToCartesian(centerX, centerY, radius - 12, markerAngle);

    return (
      <div className="relative w-full mx-auto">
        {/* ì°¨íŠ¸ ì˜ì—­ - viewBoxë¥¼ ì¡°ì •í•˜ì—¬ í•˜ë‹¨ ë¹ˆ ê³µê°„ ì œê±° */}
        <div className="relative">
          <svg className="w-full" viewBox="0 0 100 65" style={{ height: 'auto', aspectRatio: '100/65' }}>
            {/* ë°°ê²½ í˜¸ */}
            <path
              d={describeArc(centerX, centerY, radius, startAngle, startAngle + totalAngle)}
              stroke="#f3f4f6"
              strokeWidth="12"
              fill="none"
              strokeLinecap="round"
            />
            
            {/* ë¯¸ë§Œ êµ¬ê°„ (ë…¸ë€ìƒ‰) - ë¨¼ì € ê·¸ë¦¬ê³  ì™¼ìª½ ë round */}
            <path
              d={lowPath}
              stroke="#eab308"
              strokeWidth="12"
              fill="none"
              strokeLinecap="round"
            />
            
            {/* ì´ˆê³¼ êµ¬ê°„ (ë¹¨ê°„ìƒ‰) - ë‘ ë²ˆì§¸ë¡œ ê·¸ë¦¬ê³  ì˜¤ë¥¸ìª½ ë round */}
            <path
              d={highPath}
              stroke="#ef4444"
              strokeWidth="12"
              fill="none"
              strokeLinecap="round"
            />
            
            {/* ì •ìƒ êµ¬ê°„ (ë…¹ìƒ‰) - ê°€ì¥ ë§ˆì§€ë§‰ì— ê·¸ë¦¬ê³  buttë¡œ ì¤‘ê°„ ê²½ê³„ ë®ì–´ì“°ê¸° */}
            <path
              d={normalPath}
              stroke="#10b981"
              strokeWidth="12"
              fill="none"
              strokeLinecap="butt"
            />
            
            {/* í˜„ì¬ ê°’ ë§ˆì»¤ */}
            <g>
              {/* ë§ˆì»¤ ë¼ì¸ */}
              <line
                x1={markerPosInner.x}
                y1={markerPosInner.y}
                x2={markerPos.x}
                y2={markerPos.y}
                stroke="#1f2937"
                strokeWidth="4"
                strokeLinecap="round"
              />
              {/* ë§ˆì»¤ ì  */}
              <circle
                cx={markerPos.x}
                cy={markerPos.y}
                r="4"
                fill="#1f2937"
              />
            </g>
          </svg>
          
          {/* ì¤‘ì•™ ê°’ í‘œì‹œ - ìƒˆë¡œìš´ ë ˆì´ì•„ì›ƒ */}
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="text-center mt-32">
              {/* ì¸¡ì •ê°’ê³¼ ë‹¨ìœ„ */}
              <div className="text-4xl font-bold text-gray-900 mb-1">
                {value.toFixed(value < 10 ? 2 : 1)}{unit && ` ${unit}`}
              </div>
              
              {/* ì •ìƒ ë²”ìœ„ í‘œì‹œ */}
              <div className="text-sm text-gray-600 mb-1">
                ì •ìƒ : {normalRange.min.toFixed(normalRange.min < 1 ? 3 : normalRange.min < 10 ? 2 : 1)}{unit && ` ${unit}`} ~ {normalRange.max.toFixed(normalRange.max < 1 ? 3 : normalRange.max < 10 ? 2 : 1)}{unit && ` ${unit}`}
              </div>
              
              {/* ìƒíƒœ í‘œì‹œ - Chip í˜•íƒœ */}
              <div className="mt-2">
                <Badge 
                  variant="outline" 
                  className={
                    status === 'normal'
                      ? 'bg-green-100 text-green-800 border-green-200' 
                      : status === 'high'
                      ? 'bg-red-100 text-red-800 border-red-200'
                      : 'bg-yellow-100 text-yellow-800 border-yellow-200'
                  }
                >
                  {status === 'normal' ? 'ì •ìƒ' : status === 'high' ? 'ë†’ìŒ' : 'ë‚®ìŒ'}
                </Badge>
              </div>
            </div>
          </div>
        </div>
        
        {/* ë²”ìœ„ ë¼ë²¨ - ì°¨íŠ¸ ë°”ë¡œ ì•„ë˜ì— ë°€ì°© */}
        <div className="flex justify-between text-sm text-gray-500 px-4 -mt-1">
          <span>{customLabels?.low || 'ë¯¸ë§Œ'}</span>
          <span>{customLabels?.normal || 'ì •ìƒ'}</span>
          <span>{customLabels?.high || 'ì´ˆê³¼'}</span>
        </div>
      </div>
    );
  };

  // ë‡ŒíŒŒ ì§€í‘œ ë°ì´í„° ì •ì˜
  const eegMetrics = [
    {
      id: 'focusIndex',
      title: 'ì§‘ì¤‘ë ¥ ì§€ìˆ˜',
      subtitle: 'Focus Index',
      value: 2.02,
      normalRange: { min: 1.8, max: 2.4 },
      unit: '',
      status: 'normal' as const,
      normalRangeText: '1.8 - 2.4',
      currentState: 'ì–‘í˜¸',
      interpretation: 'í˜„ì¬ ì§‘ì¤‘ë ¥ì´ ì •ìƒ ë²”ìœ„ì— ìˆìœ¼ë©°, ì¸ì§€ì  ì£¼ì˜ë ¥ì´ ì ì ˆíˆ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì§€ì†ì ì¸ ì§‘ì¤‘ ìƒíƒœë¥¼ ì˜ ìœ ì§€í•˜ê³  ìˆì–´ í•™ìŠµì´ë‚˜ ì—…ë¬´ íš¨ìœ¨ì„±ì´ ë†’ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.'
    },
    {
      id: 'relaxationIndex',
      title: 'ì´ì™„ë„ ì§€ìˆ˜',
      subtitle: 'Relaxation Index',
      value: 0.20,
      normalRange: { min: 0.18, max: 0.22 },
      unit: '',
      status: 'normal' as const,
      normalRangeText: '0.18 - 0.22',
      currentState: 'ì–‘í˜¸',
      interpretation: 'ì ì ˆí•œ ì´ì™„ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ ì˜ ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì •ì‹ ì  íœ´ì‹ê³¼ íšŒë³µ ëŠ¥ë ¥ì´ ì–‘í˜¸í•˜ë©°, ê³¼ë„í•œ ê¸´ì¥ ì—†ì´ í¸ì•ˆí•œ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.'
    },
    {
      id: 'stressIndex',
      title: 'ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜',
      subtitle: 'Stress Index',
      value: 3.2,
      normalRange: { min: 2.0, max: 4.0 },
      unit: '',
      status: 'normal' as const,
      normalRangeText: '2.0 - 4.0',
      currentState: 'ì–‘í˜¸',
      interpretation: 'ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì´ ì •ìƒ ë²”ìœ„ ë‚´ì— ìˆì–´ ì ì ˆí•œ ê°ì„± ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³¼ë„í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ ê¸´ì¥ ì—†ì´ ì¼ìƒ í™œë™ì— ì í•©í•œ ì •ì‹ ì  ìƒíƒœë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.'
    },
    {
      id: 'hemisphericBalance',
      title: 'ì¢Œìš°ë‡Œ ê· í˜•',
      subtitle: 'Hemispheric Balance',
      value: -0.04,
      normalRange: { min: -0.1, max: 0.1 },
      unit: '',
      status: 'normal' as const,
      normalRangeText: '-0.1 ~ 0.1',
      currentState: 'ê· í˜•',
      interpretation: 'ì¢Œìš°ë‡Œ í™œì„±ë„ê°€ ê· í˜•ì„ ì´ë£¨ê³  ìˆì–´ ë…¼ë¦¬ì  ì‚¬ê³ ì™€ ì°½ì˜ì  ì‚¬ê³ ê°€ ì¡°í™”ë¡­ê²Œ ì‘ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì¸ì§€ì  ì²˜ë¦¬ ëŠ¥ë ¥ì´ ê· í˜•ì ìœ¼ë¡œ ë°œë‹¬ë˜ì–´ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.',
      customLabels: { low: 'ìš°ë‡Œìš°ì„¸', normal: 'ê· í˜•', high: 'ì¢Œë‡Œìš°ì„¸' }
    },
    {
      id: 'cognitiveLoad',
      title: 'ì¸ì§€ ë¶€í•˜',
      subtitle: 'Cognitive Load',
      value: 0.55,
      normalRange: { min: 0.3, max: 0.8 },
      unit: '',
      status: 'normal' as const,
      normalRangeText: '0.3 - 0.8',
      currentState: 'ì ì •',
      interpretation: 'ì¸ì§€ì  ë¶€í•˜ê°€ ì ì ˆí•œ ìˆ˜ì¤€ì— ìˆì–´ ì •ë³´ ì²˜ë¦¬ ëŠ¥ë ¥ì´ íš¨ìœ¨ì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³¼ë„í•œ ì¸ì§€ì  ë¶€ë‹´ ì—†ì´ ë³µì¡í•œ ì‚¬ê³  ê³¼ì •ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.'
    },
    {
      id: 'totalPower',
      title: 'ì‹ ê²½ í™œì„±ë„',
      subtitle: 'Total Power',
      value: 1020,
      normalRange: { min: 850, max: 1150 },
      unit: 'ÂµVÂ²',
      status: 'normal' as const,
      normalRangeText: '850 - 1150 ÂµVÂ²',
      currentState: 'ì–‘í˜¸',
      interpretation: 'ì „ì²´ì ì¸ ë‡Œ í™œì„±ë„ê°€ ì •ìƒ ë²”ìœ„ì— ìˆì–´ ì‹ ê²½ê³„ ê¸°ëŠ¥ì´ ê±´ê°•í•˜ê²Œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì ˆí•œ ì‹ ê²½ í™œë™ ìˆ˜ì¤€ì„ ìœ ì§€í•˜ê³  ìˆì–´ ì¸ì§€ ê¸°ëŠ¥ê³¼ ì •ì„œ ì¡°ì ˆì´ ì›í™œí•©ë‹ˆë‹¤.'
    }
  ];

  // ìƒíƒœ íŒë‹¨ í•¨ìˆ˜
  const getMetricStatus = (value: number, normalRange: { min: number; max: number }): 'low' | 'normal' | 'high' => {
    if (value < normalRange.min) return 'low';
    if (value > normalRange.max) return 'high';
    return 'normal';
  };

  // EEG ì§€í‘œ ì¹´ë“œ ë°°ê²½ìƒ‰ ê²°ì • í•¨ìˆ˜
  const getEEGCardBackgroundClass = (status: 'low' | 'normal' | 'high') => {
    switch (status) {
      case 'normal':
        return 'bg-white border-gray-200';
      case 'low':
        return 'bg-yellow-50 border-yellow-200';
      case 'high':
        return 'bg-red-50 border-red-200';
      default:
        return 'bg-white border-gray-200';
    }
  };

  // PPG ì§€í‘œ ë°ì´í„° ì¤€ë¹„ í•¨ìˆ˜ (ì‹ ì²´ê±´ê°• ë¶„ì„ìš©)
  const preparePPGMetrics = () => {
    const ppgMetrics = [
      // ì²« ë²ˆì§¸ í–‰: ì‹¬ë°•ìˆ˜ | ì‚°ì†Œí¬í™”ë„
      {
        id: 'heartRate',
        title: 'ì‹¬ë°•ìˆ˜',
        subtitle: 'Heart Rate',
        value: report.measurementData.ppgMetrics?.heartRate?.value || 79,
        normalRange: { min: 60, max: 100 },
        unit: 'BPM',
        status: getMetricStatus(report.measurementData.ppgMetrics?.heartRate?.value || 79, { min: 60, max: 100 }),
        normalRangeText: '60-100 BPM',
        currentState: 'ì •ìƒ ë²”ìœ„ - ê±´ê°•í•œ ì‹¬ë°•ìˆ˜',
        interpretation: physicalHealthComprehensive?.individualMetricsInterpretation?.heartRate?.interpretation || 
                        report.measurementData.ppgMetrics?.heartRate?.interpretation || 
                        'ì‹¬ì¥ì˜ ìˆ˜ì¶• ë¹ˆë„ë¡œ ì‹¬í˜ˆê´€ ê±´ê°•ê³¼ ììœ¨ì‹ ê²½ê³„ ìƒíƒœë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤. í˜„ì¬ ì‹¬ë°•ìˆ˜ëŠ” ì •ìƒ ë²”ìœ„ì— ìˆì–´ ê±´ê°•í•œ ì‹¬í˜ˆê´€ ê¸°ëŠ¥ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.',
        customLabels: { low: 'ì„œë§¥', normal: 'ì •ìƒ', high: 'ë¹ˆë§¥' }
      },
      {
        id: 'spo2',
        title: 'ì‚°ì†Œí¬í™”ë„',
        subtitle: 'SpO2',
        value: report.measurementData.ppgMetrics?.spo2?.value || 92,
        normalRange: { min: 95, max: 100 },
        unit: '%',
        status: getMetricStatus(report.measurementData.ppgMetrics?.spo2?.value || 92, { min: 95, max: 100 }),
        normalRangeText: '95-100%',
        currentState: 'ì •ìƒ ë²”ìœ„ ë¯¸ë‹¬ - ì‚°ì†Œ ê³µê¸‰ ë¶€ì¡± (ì˜ë£Œì§„ ìƒë‹´ ê¶Œì¥)',
        interpretation: physicalHealthComprehensive?.individualMetricsInterpretation?.spo2?.interpretation || 
                        report.measurementData.ppgMetrics?.spo2?.interpretation || 
                        'í˜ˆì•¡ ë‚´ ì‚°ì†Œ í¬í™”ë„ë¡œ í˜¸í¡ ë° ìˆœí™˜ ê¸°ëŠ¥ì„ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ ìˆ˜ì¹˜ëŠ” ì •ìƒ ë²”ìœ„ì— ìˆì–´ ì ì ˆí•œ ì‚°ì†Œ ê³µê¸‰ì´ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
        customLabels: { low: 'ë¶€ì¡±', normal: 'ì •ìƒ', high: 'ê³¼í¬í™”' }
      },
      // ë‘ ë²ˆì§¸ í–‰: ì‹¬ë°•ë³€ì´ë„ RMSSD | ì‹¬ë°•ë³€ì´ë„ SDNN
      {
        id: 'rmssd',
        title: 'ì‹¬ë°•ë³€ì´ë„ RMSSD',
        subtitle: 'RMSSD',
        value: report.measurementData.ppgMetrics?.rmssd?.value || 229,
        normalRange: { min: 20, max: 50 },
        unit: 'ms',
        status: getMetricStatus(report.measurementData.ppgMetrics?.rmssd?.value || 229, { min: 20, max: 50 }),
        normalRangeText: '20-50 ms',
        currentState: 'ì •ìƒ ë²”ìœ„ ì´ˆê³¼ - ë§¤ìš° í™œë°œí•œ ë¶€êµê°ì‹ ê²½ í™œë™',
        interpretation: physicalHealthComprehensive?.individualMetricsInterpretation?.rmssd?.interpretation || 
                        report.measurementData.ppgMetrics?.rmssd?.interpretation || 
                        'ì—°ì†ëœ ì‹¬ë°• ê°„ê²©ì˜ ë³€ì´ë¥¼ ì¸¡ì •í•˜ì—¬ ë¶€êµê°ì‹ ê²½ í™œì„±ë„ì™€ ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ RMSSD ìˆ˜ì¹˜ëŠ” ìš°ìˆ˜í•œ ììœ¨ì‹ ê²½ ê· í˜•ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.',
        customLabels: { low: 'ë‚®ìŒ', normal: 'ì–‘í˜¸', high: 'ë†’ìŒ' }
      },
      {
        id: 'sdnn',
        title: 'ì‹¬ë°•ë³€ì´ë„ SDNN',
        subtitle: 'SDNN',
        value: report.measurementData.ppgMetrics?.sdnn?.value || 188,
        normalRange: { min: 30, max: 100 },
        unit: 'ms',
        status: getMetricStatus(report.measurementData.ppgMetrics?.sdnn?.value || 188, { min: 30, max: 100 }),
        normalRangeText: '30-100 ms',
        currentState: 'ì •ìƒ ë²”ìœ„ ì´ˆê³¼ - ë§¤ìš° ë†’ì€ ììœ¨ì‹ ê²½ í™œì„±ë„',
        interpretation: physicalHealthComprehensive?.individualMetricsInterpretation?.sdnn?.interpretation || 
                        report.measurementData.ppgMetrics?.sdnn?.interpretation || 
                        'ì „ì²´ ì‹¬ë°•ë³€ì´ë„ë¥¼ ë‚˜íƒ€ë‚´ë©°, ììœ¨ì‹ ê²½ê³„ì˜ ì „ë°˜ì ì¸ ê±´ê°• ìƒíƒœë¥¼ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ SDNN ìˆ˜ì¹˜ëŠ” ë§¤ìš° ê±´ê°•í•œ ììœ¨ì‹ ê²½ ê¸°ëŠ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.',
        customLabels: { low: 'ë‚®ìŒ', normal: 'ì–‘í˜¸', high: 'ë†’ìŒ' }
      },
      // ì„¸ ë²ˆì§¸ í–‰: LF Power | HF Power
      {
        id: 'lfPower',
        title: 'LF Power',
        subtitle: 'ì €ì£¼íŒŒ ì„±ë¶„',
        value: report.measurementData.ppgMetrics?.lfPower?.value || 14863.64,
        normalRange: { min: 500, max: 20000 },
        unit: 'msÂ²',
        status: getMetricStatus(report.measurementData.ppgMetrics?.lfPower?.value || 14863.64, { min: 500, max: 20000 }),
        normalRangeText: '500-20000 msÂ²',
        currentState: 'ì •ìƒ ë²”ìœ„ - ì–‘í˜¸í•œ êµê°ì‹ ê²½ í™œë™',
        interpretation: report.measurementData.ppgMetrics?.lfPower?.interpretation || 
                        'êµê°ì‹ ê²½ í™œì„±ë„ë¥¼ ë°˜ì˜í•˜ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ê³¼ í˜ˆì•• ì¡°ì ˆ ëŠ¥ë ¥ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. í˜„ì¬ LF PowerëŠ” ê±´ê°•í•œ êµê°ì‹ ê²½ ê¸°ëŠ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.',
        customLabels: { low: 'ë‚®ìŒ', normal: 'ì–‘í˜¸', high: 'ë†’ìŒ' }
      },
      {
        id: 'hfPower',
        title: 'HF Power',
        subtitle: 'ê³ ì£¼íŒŒ ì„±ë¶„',
        value: report.measurementData.ppgMetrics?.hfPower?.value || 1708.49,
        normalRange: { min: 200, max: 5000 },
        unit: 'msÂ²',
        status: getMetricStatus(report.measurementData.ppgMetrics?.hfPower?.value || 1708.49, { min: 200, max: 5000 }),
        normalRangeText: '200-5000 msÂ²',
        currentState: 'ì •ìƒ ë²”ìœ„ - ì–‘í˜¸í•œ ë¶€êµê°ì‹ ê²½ í™œë™',
        interpretation: report.measurementData.ppgMetrics?.hfPower?.interpretation || 
                        'ë¶€êµê°ì‹ ê²½ í™œì„±ë„ë¥¼ ë°˜ì˜í•˜ë©°, íœ´ì‹ ë° íšŒë³µ ëŠ¥ë ¥ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. í˜„ì¬ HF PowerëŠ” ì–‘í˜¸í•œ ë¶€êµê°ì‹ ê²½ ê¸°ëŠ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.',
        customLabels: { low: 'ë‚®ìŒ', normal: 'ì–‘í˜¸', high: 'ë†’ìŒ' }
      },
      // ë„¤ ë²ˆì§¸ í–‰: ììœ¨ì‹ ê²½ ê· í˜• (ë‹¨ë…)
      {
        id: 'lfHfRatio',
        title: 'ììœ¨ì‹ ê²½ ê· í˜•',
        subtitle: 'LF/HF Ratio',
        value: report.measurementData.ppgMetrics?.lfHfRatio?.value || 8.70,
        normalRange: { min: 1.0, max: 10.0 },
        unit: '',
        status: getMetricStatus(report.measurementData.ppgMetrics?.lfHfRatio?.value || 8.70, { min: 1.0, max: 10.0 }),
        normalRangeText: '1.0-10.0',
        currentState: 'ì •ìƒ ë²”ìœ„ - ê· í˜•ì¡íŒ ììœ¨ì‹ ê²½ í™œë™',
        interpretation: physicalHealthComprehensive?.individualMetricsInterpretation?.lfHfRatio?.interpretation || 
                        report.measurementData.ppgMetrics?.lfHfRatio?.interpretation || 
                        'êµê°ì‹ ê²½ê³¼ ë¶€êµê°ì‹ ê²½ì˜ ê· í˜•ì„ ë‚˜íƒ€ë‚´ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‘ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ ììœ¨ì‹ ê²½ ê· í˜•ì€ ì ì ˆí•œ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
        customLabels: { low: 'ë¶€êµê°ìš°ì„¸', normal: 'ê· í˜•', high: 'êµê°ìš°ì„¸' }
      }
    ];

    return ppgMetrics;
  };

  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-6 space-y-6">
        {/* í—¤ë” */}
        <div className="flex items-center justify-between mb-6 bg-white p-6 rounded-lg shadow-sm border">
          <div className="flex items-center gap-4">
            <Button
              onClick={onBack}
              variant="outline"
              className="flex items-center gap-2 border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400"
            >
              <ArrowLeft className="h-4 w-4" />
              ëª©ë¡ìœ¼ë¡œ
            </Button>
            <div>
              <h1 className="text-2xl font-bold text-gray-900">
                {personalInfo.name}ë‹˜ì˜ ê±´ê°• ë¦¬í¬íŠ¸
                {isCurrentAnalysis && (
                  <Badge className="ml-2 bg-green-100 text-green-800">
                    í˜„ì¬ ë¶„ì„
                  </Badge>
                )}
              </h1>
              <div className="flex items-center gap-4 mt-2">
                <div className="flex items-center gap-2 text-gray-600">
                <Calendar className="h-4 w-4" />
                {formatDate(report.timestamp)}
              </div>
                <div className="flex items-center gap-2">
                  <Badge variant="outline" className="border-blue-300 text-blue-700 bg-blue-50">
                    {personalInfo.age}ì„¸
                  </Badge>
                  <Badge variant="outline" className="border-green-300 text-green-700 bg-green-50">
                    {personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}
                  </Badge>
                  <Badge variant="outline" className="border-purple-300 text-purple-700 bg-purple-50">
                    {getOccupationLabel(personalInfo.occupation)}
                  </Badge>
            </div>
          </div>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            {/* ğŸ†• EEG ìƒì„¸ ë¶„ì„ ë²„íŠ¼ */}
            {showEEGButton && onViewEEGAnalysis && (
              <Button
                onClick={onViewEEGAnalysis}
                variant="outline"
                className="flex items-center gap-2 text-blue-600 border-blue-600 hover:bg-blue-50"
              >
                <Brain className="h-4 w-4" />
                EEG ìƒì„¸
              </Button>
            )}
            
            {/* ğŸ†• PPG ìƒì„¸ ë¶„ì„ ë²„íŠ¼ */}
            {showPPGButton && onViewPPGAnalysis && (
              <Button
                onClick={onViewPPGAnalysis}
                variant="outline"
                className="flex items-center gap-2 text-red-600 border-red-600 hover:bg-red-50"
              >
                <Heart className="h-4 w-4" />
                PPG ìƒì„¸
              </Button>
            )}
            
            {/* ğŸ†• ì €ì¥ ë²„íŠ¼ */}
            {showSaveButton && onSave && (
              <Button
                onClick={onSave}
                disabled={isSaving}
                className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white"
              >
                {isSaving ? (
                  <>
                    <Loader2 className="h-4 w-4 animate-spin" />
                    ì €ì¥ ì¤‘...
                  </>
                ) : (
                  <>
                    <FileText className="h-4 w-4" />
                    {saveSuccess ? 'ì €ì¥ë¨' : 'ì €ì¥'}
                  </>
                )}
              </Button>
            )}
            
            {/* ğŸ†• ê³µìœ  ë²„íŠ¼ */}
            {showShareButton && onShare && (
              <Button
                onClick={onShare}
                variant="outline"
                className="flex items-center gap-2"
              >
                <Users className="h-4 w-4" />
                ê³µìœ 
              </Button>
            )}
            
          <Button
            onClick={handleDownloadPDF}
            disabled={downloadingPDF}
            className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white"
          >
            <Download className="h-4 w-4" />
            {downloadingPDF ? 'PDF ìƒì„± ì¤‘...' : 'PDF ë‹¤ìš´ë¡œë“œ'}
          </Button>
          </div>
        </div>

        {/* 1ë‹¨ê³„: ì „ì²´ ê±´ê°• ê°œìš” */}
        <OverallHealthReport
          report={report}
          analysisResult={analysisResult}
          isExpanded={expandedSections.overview}
          onToggleExpanded={() => setExpandedSections(prev => ({
            ...prev,
            overview: !prev.overview
          }))}
          EEGMetricChart={EEGMetricChart}
        />


        {/* 2ë‹¨ê³„: ìƒì„¸ ë¶„ì„ ê²°ê³¼ */}
        <EEGPPGDetailAnalysisReport
          report={report}
          analysisResult={analysisResult}
          isExpanded={expandedSections.analysis}
          onToggleExpanded={() => setExpandedSections(prev => ({
            ...prev,
            analysis: !prev.analysis
          }))}
          EEGMetricChart={EEGMetricChart}
          getScoreBadgeColor={getScoreBadgeColor}
          getOccupationLabel={getOccupationLabel}
          ScoreDistributionBar={ScoreDistributionBar}
          mentalHealthComprehensive={mentalHealthComprehensive}
          physicalHealthComprehensive={physicalHealthComprehensive}
          loadingComprehensive={loadingComprehensive}
          preparePPGMetrics={preparePPGMetrics}
          getMetricStatus={getMetricStatus}
          getEEGCardBackgroundClass={getEEGCardBackgroundClass}
        />
          
          {expandedSections.analysis && (
            <CardContent className="p-6 bg-white">
              <div className="space-y-8">


                {/* ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ë“¤ */}
                <div className="grid grid-cols-1 gap-6">
                  {/* ì •ì‹ ê±´ê°• ë¶„ì„ */}
                  {analysisResult.detailedAnalysis?.mentalHealth && (
                    <Card className="bg-gray-50 border-gray-200">
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-gray-900">
                          <Brain className="w-5 h-5 text-purple-600" />
                          ğŸ§  ë‡ŒíŒŒ ë¶„ì„ ê²°ê³¼
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-8">
                        
                        {/* 1. ì •ì‹  ê±´ê°• ë¶„ì„ ì¢…í•© í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ë‡ŒíŒŒ ë¶„ì„ ì¢…í•© í•´ì„
                          </h3>
                          
                          <div className="bg-white p-4 rounded-lg border border-gray-200">
                            <div className="flex items-center justify-between mb-4">
                              <div>
                                <div className="text-sm text-purple-600 font-medium mb-1">
                                  ë‡ŒíŒŒ ê¸°ë°˜ ì •ì‹ ê±´ê°• ì ìˆ˜
                                </div>
                                <div className="text-2xl font-bold text-gray-900">
                                  {analysisResult.detailedAnalysis.mentalHealth.score}ì 
                                </div>
                              </div>
                              <div>
                                <Badge className={getScoreBadgeColor(analysisResult.detailedAnalysis.mentalHealth.score)}>
                                  {analysisResult.detailedAnalysis.mentalHealth.status}
                                </Badge>
                              </div>
                            </div>
                            
                            {/* ì ìˆ˜ ë¶„í¬ í‘œì‹œ */}
                            <ScoreDistributionBar 
                              score={analysisResult.detailedAnalysis.mentalHealth.score} 
                              label="ì •ì‹ ê±´ê°• ì ìˆ˜"
                            />
                            
                            <div className="mt-4 prose prose-sm max-w-none prose-gray">
                              <h4 className="text-base font-semibold text-gray-900 mb-2">í•´ì„</h4>
                              {loadingComprehensive ? (
                                <div className="flex items-center gap-2 p-4 bg-gray-50 rounded-lg">
                                  <Loader2 className="w-4 h-4 animate-spin text-gray-500" />
                                  <span className="text-sm text-gray-600">ì •ì‹ ê±´ê°• ì¢…í•© í•´ì„ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
                                </div>
                              ) : mentalHealthComprehensive ? (
                                <AIAnalysisMarkdownRenderer content={mentalHealthComprehensive.comprehensiveInterpretation} />
                              ) : (
                                <AIAnalysisMarkdownRenderer content={
                                  // ê¸°ë³¸ ë‡Œ ê¸°ëŠ¥ ë¶€ë¶„ë§Œ ì¶”ì¶œí•˜ì—¬ ê°„ë‹¨í•œ ì¢…í•© í•´ì„ ì œê³µ
                                  `ğŸ§  **ë‡Œ ê¸°ëŠ¥ ì¢…í•© ë¶„ì„**\n\nì§‘ì¤‘ë ¥ ì§€ìˆ˜ ${report.measurementData.eegMetrics.focusIndex?.value?.toFixed(3) || 'N/A'}ì™€ ì´ì™„ë„ ${report.measurementData.eegMetrics.relaxationIndex?.value?.toFixed(3) || 'N/A'}ëŠ” í˜„ì¬ ë‡Œ ê¸°ëŠ¥ì´ ì–‘í˜¸í•˜ê²Œ ìœ ì§€ë˜ê³  ìˆìŒì„ ë³´ì—¬ì£¼ë‚˜, ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ ${report.measurementData.eegMetrics.stressIndex?.value?.toFixed(3) || 'N/A'}ê³¼ ì¸ì§€ ë¶€í•˜ ${report.measurementData.eegMetrics.cognitiveLoad?.value?.toFixed(3) || 'N/A'}ëŠ” ì •ì‹ ì  ê¸´ì¥ê³¼ ë‡Œ í™œë™ëŸ‰ ì¦ê°€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì •ì„œ ì•ˆì •ì„± ${report.measurementData.eegMetrics.emotionalStability?.value?.toFixed(3) || 'N/A'}ì€ ê°ì • ì¡°ì ˆ ëŠ¥ë ¥ì´ ë¹„êµì  ì˜ ìœ ì§€ë˜ê³  ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤.`
                                } />
                              )}
                            </div>
                          </div>
                        </div>

                        {/* 2. ê°œì¸í™”ëœ ì •ì‹  ê±´ê°• í‰ê°€ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ê°œì¸í™”ëœ ë‡ŒíŒŒ ë¶„ì„ í‰ê°€
                          </h3>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {/* ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Users className="w-4 h-4 text-blue-600" />
                                ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì—°ë ¹ëŒ€:</span>
                                  <span className="font-medium">{report.personalInfo.age}ì„¸</span>
                                </div>
                                <div className="flex justify-between">
                                  <span>ì„±ë³„:</span>
                                  <span className="font-medium">{report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}</span>
                                </div>
                                <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                                  {loadingComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-blue-600" />
                                      <span className="text-sm text-blue-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : mentalHealthComprehensive ? (
                                    <div className="space-y-2">
                                      <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì—°ë ¹ëŒ€ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{mentalHealthComprehensive.ageSpecificAnalysis.currentComparison}</p>
                                      </div>
                                      <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì„±ë³„ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{mentalHealthComprehensive.genderSpecificAnalysis.brainPatternCharacteristics}</p>
                                      </div>
                                    </div>
                                  ) : (
                                    <p className="text-sm text-blue-800">
                                      {/* AI ë¶„ì„ ê²°ê³¼ì—ì„œ ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„± ë¶„ì„ */}
                                      {analysisResult.personalContext?.personalizedMessage || 
                                       analysisResult.overallAssessment?.personalizedInterpretation ||
                                       `${report.personalInfo.age}ì„¸ ${report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}ì˜ ë‡ŒíŒŒ íŒ¨í„´ì„ ë¶„ì„í•œ ê²°ê³¼, í•´ë‹¹ ì—°ë ¹ëŒ€ì™€ ì„±ë³„ì˜ ì¼ë°˜ì ì¸ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ê°œì¸í™”ëœ ì •ì‹ ê±´ê°• í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`}
                                    </p>
                                  )}
                                </div>
                              </div>
                            </div>

                            {/* ì§ì—…ì  íŠ¹ì„± ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Briefcase className="w-4 h-4 text-green-600" />
                                ì§ì—…ì  íŠ¹ì„± ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì§ì—…:</span>
                                  <span className="font-medium">{getOccupationLabel(report.personalInfo.occupation)}</span>
                                </div>
                                <div className="mt-3 p-3 bg-green-50 rounded-lg">
                                  {loadingComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-green-600" />
                                      <span className="text-sm text-green-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : mentalHealthComprehensive ? (
                                    <div className="space-y-2">
                                      <div>
                                        <h5 className="text-xs font-medium text-green-900 mb-1">ì—…ë¬´ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-green-800">{mentalHealthComprehensive.occupationalAnalysis.workRequirements}</p>
                                      </div>
                                      <div>
                                        <h5 className="text-xs font-medium text-green-900 mb-1">í˜„ì¬ ì í•©ì„±:</h5>
                                        <p className="text-sm text-green-800">{mentalHealthComprehensive.occupationalAnalysis.brainFunctionMatch}</p>
                                      </div>
                                      
                                      {/* ì§ì—…ë³„ ë§ì¶¤ ì „ëµ */}
                                      {mentalHealthComprehensive.personalizedRecommendations?.occupationSpecific?.length > 0 && (
                                        <div className="mt-3 pt-3 border-t border-green-200">
                                          <h5 className="text-xs font-medium text-green-900 mb-2">ì§ì—…ë³„ ë§ì¶¤ ì „ëµ:</h5>
                                          <ul className="space-y-1">
                                            {mentalHealthComprehensive.personalizedRecommendations.occupationSpecific.slice(0, 2).map((strategy, index) => (
                                              <li key={index} className="text-xs text-green-700 flex items-start gap-1">
                                                <span className="text-green-500 mt-0.5">â€¢</span>
                                                <span>{strategy}</span>
                                              </li>
                                            ))}
                                          </ul>
                                        </div>
                                      )}
                                    </div>
                                  ) : (
                                    <div>
                                      <p className="text-sm text-green-800">
                                        {/* AI ë¶„ì„ ê²°ê³¼ì—ì„œ ì§ì—…ë³„ íŠ¹ì„± ë¶„ì„ */}
                                        {analysisResult.personalizedRecommendations?.occupationSpecific?.workplaceStrategies?.length > 0 ? 
                                          `${getOccupationLabel(report.personalInfo.occupation)} ì§ì—…ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•œ ë§ì¶¤í˜• ì •ì‹ ê±´ê°• ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤. ì§ì—…ì  ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸ê³¼ ì—…ë¬´ í™˜ê²½ì„ ë°˜ì˜í•œ ê°œì¸í™”ëœ ê±´ê°• ê´€ë¦¬ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.` :
                                          `${getOccupationLabel(report.personalInfo.occupation)} ì§ì—…êµ°ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•œ ë§ì¶¤í˜• ì •ì‹ ê±´ê°• ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.`}
                                      </p>
                                      
                                      {/* ì§ì—…ë³„ ë§ì¶¤ ì „ëµì´ ìˆëŠ” ê²½ìš° í‘œì‹œ */}
                                      {analysisResult.personalizedRecommendations?.occupationSpecific?.workplaceStrategies?.length > 0 && (
                                        <div className="mt-3 pt-3 border-t border-green-200">
                                          <h5 className="text-xs font-medium text-green-900 mb-2">ì§ì—…ë³„ ë§ì¶¤ ì „ëµ:</h5>
                                          <ul className="space-y-1">
                                            {analysisResult.personalizedRecommendations.occupationSpecific.workplaceStrategies.slice(0, 2).map((strategy, index) => (
                                              <li key={index} className="text-xs text-green-700 flex items-start gap-1">
                                                <span className="text-green-500 mt-0.5">â€¢</span>
                                                <span>{strategy}</span>
                                              </li>
                                            ))}
                                          </ul>
                                        </div>
                                      )}
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        {/* 3. ë‡ŒíŒŒ ì§€í‘œ ìƒì„¸ í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ë‡ŒíŒŒ ì§€í‘œ ìƒì„¸ í•´ì„
                          </h3>
                          
                          {/* 2x3 ê·¸ë¦¬ë“œ */}
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {/* ì§‘ì¤‘ë ¥ ì§€ìˆ˜ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.focusIndex?.value || 0) >= 1.8 && 
                              (report.measurementData.eegMetrics.focusIndex?.value || 0) <= 2.4 ? 'normal' : 
                              (report.measurementData.eegMetrics.focusIndex?.value || 0) < 1.8 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì§‘ì¤‘ë ¥ ì§€ìˆ˜
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Focus Index</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.focusIndex?.value || 0}
                                      normalRange={{ min: 1.8, max: 2.4 }}
                                      label="ì§‘ì¤‘ë ¥ ì§€ìˆ˜"
                                      unit=""
                                      status={
                                        (report.measurementData.eegMetrics.focusIndex?.value || 0) >= 1.8 && 
                                        (report.measurementData.eegMetrics.focusIndex?.value || 0) <= 2.4 ? 'normal' : 
                                        (report.measurementData.eegMetrics.focusIndex?.value || 0) > 2.4 ? 'high' : 'low'
                                      }
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.focusIndex?.interpretation || 
                                         analysisResult.detailedAnalysis.mentalHealth.keyMetrics.concentration ||
                                         "ë² íƒ€íŒŒ ê¸°ë°˜ ì§‘ì¤‘ë ¥ ì§€ìˆ˜ 2.02: ë² íƒ€íŒŒ ê¸°ë°˜ ì£¼ì˜ ì§‘ì¤‘ ëŠ¥ë ¥ì´ ì •ìƒ ë²”ìœ„ì— ìˆì–´ ì¸ì§€ ì²˜ë¦¬ ê³¼ì •ì´ ì–‘í˜¸í•˜ê²Œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì—…ë¬´ë‚˜ í•™ìŠµ ì‹œ ì ì ˆí•œ ì§‘ì¤‘ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤."}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì´ì™„ë„ ì§€ìˆ˜ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22 ? 'normal' : 
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) < 0.18 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì´ì™„ë„ ì§€ìˆ˜
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Relaxation Index</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.relaxationIndex?.value || 0}
                                      normalRange={{ min: 0.18, max: 0.22 }}
                                      label="ì´ì™„ë„ ì§€ìˆ˜"
                                      unit=""
                                      status={
                                        (report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                                        (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22 ? 'normal' : 
                                        (report.measurementData.eegMetrics.relaxationIndex?.value || 0) > 0.22 ? 'high' : 'low'
                                      }
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.relaxationIndex?.interpretation || 
                                         analysisResult.detailedAnalysis.mentalHealth.keyMetrics.relaxation ||
                                         "ì´ì™„ë„ 0.214: ì•ŒíŒŒíŒŒ ê¸°ë°˜ ì •ì‹ ì  ì´ì™„ ëŠ¥ë ¥ì´ ì •ìƒ ë²”ìœ„ì— ìˆì–´ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ë° ì •ì‹ ì  ì•ˆì • ìƒíƒœë¥¼ ì ì ˆíˆ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. íœ´ì‹ ì‹œ íš¨ê³¼ì ì¸ ì´ì™„ì´ ê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤."}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) >= 0.3 && 
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 0.7 ? 'normal' : 
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) < 0.3 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Stress Index</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.stressIndex?.value || 0}
                                      normalRange={{ min: 0.3, max: 0.7 }}
                                      label="ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜"
                                      unit=""
                                      status={
                                        (report.measurementData.eegMetrics.stressIndex?.value || 0) >= 0.3 && 
                                        (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 0.7 ? 'normal' : 
                                        (report.measurementData.eegMetrics.stressIndex?.value || 0) > 0.7 ? 'high' : 'low'
                                      }
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.stressIndex?.interpretation || 
                                         report.measurementData.eegMetrics.stressIndex?.interpretation || 
                                         'ë² íƒ€íŒŒì™€ ê°ë§ˆíŒŒì˜ ë¹„ìœ¨ì„ í†µí•´ ì •ì‹ ì  ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì„ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ëŠ” ì •ìƒ ë²”ìœ„ì— ìˆì–´ ì ì ˆí•œ ê¸´ì¥ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.'}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì¸ì§€ ë¶€í•˜ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) >= 0.4 && 
                              (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) <= 0.8 ? 'normal' : 
                              (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) < 0.4 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì¸ì§€ ë¶€í•˜
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Cognitive Load</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.cognitiveLoad?.value || 0}
                                      normalRange={{ min: 0.4, max: 0.8 }}
                                      label="ì¸ì§€ ë¶€í•˜"
                                      unit=""
                                      status={
                                        (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) >= 0.4 && 
                                        (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) <= 0.8 ? 'normal' : 
                                        (report.measurementData.eegMetrics.cognitiveLoad?.value || 0) > 0.8 ? 'high' : 'low'
                                      }
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.cognitiveLoad?.interpretation || 
                                         analysisResult.detailedAnalysis.mentalHealth.keyMetrics.cognitiveLoad ||
                                         'ì¸ì§€ ë¶€í•˜ ìˆ˜ì¤€ì„ í†µí•´ ë‡Œì˜ ì •ë³´ ì²˜ë¦¬ ê³¼ë¶€í•˜ ì •ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ ì¸ì§€ ë¶€í•˜ëŠ” ì •ìƒ ë²”ìœ„ì— ìˆì–´ ì ì ˆí•œ ì •ì‹ ì  í™œë™ëŸ‰ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.'}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì •ì„œ ì•ˆì •ì„± */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.emotionalStability?.value || 0) >= 0.5 && 
                              (report.measurementData.eegMetrics.emotionalStability?.value || 0) <= 0.9 ? 'normal' : 
                              (report.measurementData.eegMetrics.emotionalStability?.value || 0) < 0.5 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì •ì„œ ì•ˆì •ì„±
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Emotional Stability</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.emotionalStability?.value || 0}
                                      normalRange={{ min: 0.5, max: 0.9 }}
                                      label="ì •ì„œ ì•ˆì •ì„±"
                                      unit=""
                                      status={
                                        (report.measurementData.eegMetrics.emotionalStability?.value || 0) >= 0.5 && 
                                        (report.measurementData.eegMetrics.emotionalStability?.value || 0) <= 0.9 ? 'normal' : 
                                        (report.measurementData.eegMetrics.emotionalStability?.value || 0) > 0.9 ? 'high' : 'low'
                                      }
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.emotionalStability?.interpretation || 
                                         report.measurementData.eegMetrics.emotionalStability?.interpretation || 
                                         'ì•ŒíŒŒíŒŒì™€ ë² íƒ€íŒŒì˜ ë¹„ìœ¨ì„ í†µí•´ ì •ì„œì  ì•ˆì •ì„±ê³¼ ê°ì • ì¡°ì ˆ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤. í˜„ì¬ ì •ì„œ ì•ˆì •ì„±ì€ ì–‘í˜¸í•œ ìƒíƒœë¡œ ê°ì • ì¡°ì ˆì´ ì˜ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.'}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì¢Œìš°ë‡Œ ê· í˜• */}
                            <Card className={`${getEEGCardBackgroundClass(
                              Math.abs(report.measurementData.eegMetrics.hemisphericBalance?.value || 0) <= 0.1 ? 'normal' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì¢Œìš°ë‡Œ ê· í˜•
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Hemispheric Balance</p>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-1">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96">
                                    <EEGMetricChart
                                      value={report.measurementData.eegMetrics.hemisphericBalance?.value || 0}
                                      normalRange={{ min: -0.1, max: 0.1 }}
                                      label="ì¢Œìš°ë‡Œ ê· í˜•"
                                      unit=""
                                      status={
                                        Math.abs(report.measurementData.eegMetrics.hemisphericBalance?.value || 0) <= 0.1 ? 'normal' : 'high'
                                      }
                                      customLabels={{ low: 'ìš°ë‡Œìš°ì„¸', normal: 'ê· í˜•', high: 'ì¢Œë‡Œìš°ì„¸' }}
                                    />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-200 pt-2 mt-2">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                      <p className="text-sm text-gray-600 leading-relaxed">
                                        {mentalHealthComprehensive?.individualMetricsInterpretation?.hemisphericBalance?.interpretation || 
                                         report.measurementData.eegMetrics.hemisphericBalance?.interpretation || 
                                         'ì¢Œë‡Œì™€ ìš°ë‡Œì˜ í™œì„±ë„ ê· í˜•ì„ í‰ê°€í•˜ì—¬ ì¸ì§€ ê¸°ëŠ¥ì˜ ì¡°í™”ë¡œìš´ ë°œë‹¬ì„ í™•ì¸í•©ë‹ˆë‹¤. í˜„ì¬ ì¢Œìš°ë‡Œ ê· í˜•ì€ ì–‘í˜¸í•œ ìƒíƒœë¡œ ì¸ì§€ ê¸°ëŠ¥ì´ ê· í˜•ìˆê²Œ ë°œë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.'}
                                      </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>
                          </div>
                        </div>

                        {/* 4. ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥
                          </h3>
                          
                          {loadingComprehensive ? (
                            <div className="flex items-center justify-center p-8">
                              <Loader2 className="w-6 h-6 animate-spin text-gray-500" />
                              <span className="ml-2 text-gray-600">ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
                            </div>
                          ) : (
                            <div className="grid grid-cols-1 gap-4">
                              {/* ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜ */}
                              {((mentalHealthComprehensive?.personalizedRecommendations?.immediate?.length ?? 0) > 0 || 
                                (analysisResult.detailedAnalysis.mentalHealth.immediateActions?.length ?? 0) > 0) && (
                                <div className="bg-white p-4 rounded-lg border border-gray-200">
                                  <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                    <Zap className="w-4 h-4 text-red-600" />
                                    ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜
                                  </h4>
                                  <ul className="space-y-2">
                                    {(mentalHealthComprehensive?.personalizedRecommendations?.immediate || 
                                      analysisResult.detailedAnalysis.mentalHealth.immediateActions || []).map((action, index) => (
                                      <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                        <span className="text-red-500 mt-1">â€¢</span>
                                        <span>{action}</span>
                                      </li>
                                    ))}
                                  </ul>
                                </div>
                              )}
                              
                              {/* ë‹¨ê¸° ëª©í‘œ (1-4ì£¼) */}
                              {((mentalHealthComprehensive?.personalizedRecommendations?.shortTerm?.length ?? 0) > 0 || 
                                (analysisResult.detailedAnalysis.mentalHealth.shortTermGoals?.length ?? 0) > 0) && (
                                <div className="bg-white p-4 rounded-lg border border-gray-200">
                                  <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                    <Target className="w-4 h-4 text-blue-600" />
                                    ë‹¨ê¸° ëª©í‘œ (1-4ì£¼)
                                  </h4>
                                  <ul className="space-y-2">
                                    {(mentalHealthComprehensive?.personalizedRecommendations?.shortTerm || 
                                      analysisResult.detailedAnalysis.mentalHealth.shortTermGoals || []).map((goal, index) => (
                                      <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                        <span className="text-blue-500 mt-1">â€¢</span>
                                        <span>{goal}</span>
                                      </li>
                                    ))}
                                  </ul>
                                </div>
                              )}
                              
                              {/* ì¥ê¸° ì „ëµ (1-6ê°œì›”) */}
                              {((mentalHealthComprehensive?.personalizedRecommendations?.longTerm?.length ?? 0) > 0 || 
                                (analysisResult.detailedAnalysis.mentalHealth.longTermStrategy?.length ?? 0) > 0) && (
                                <div className="bg-white p-4 rounded-lg border border-gray-200">
                                  <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                    <TrendingUp className="w-4 h-4 text-purple-600" />
                                    ì¥ê¸° ì „ëµ (1-6ê°œì›”)
                                  </h4>
                                  <ul className="space-y-2">
                                    {(mentalHealthComprehensive?.personalizedRecommendations?.longTerm || 
                                      analysisResult.detailedAnalysis.mentalHealth.longTermStrategy || []).map((strategy, index) => (
                                      <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                        <span className="text-purple-500 mt-1">â€¢</span>
                                        <span>{strategy}</span>
                                      </li>
                                    ))}
                                  </ul>
                                </div>
                              )}
                            </div>
                          )}
                        </div>

                      </CardContent>
                    </Card>
                  )}

                  {/* ë§¥íŒŒ ë¶„ì„ ê²°ê³¼ */}
                  {analysisResult.detailedAnalysis?.physicalHealth && (
                    <Card className="bg-gray-50 border-gray-200">
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-gray-900">
                          <Heart className="w-5 h-5 text-red-600" />
                          â¤ï¸ ë§¥íŒŒ ë¶„ì„ ê²°ê³¼
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-8">
                        
                        {/* 1. ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„
                          </h3>
                          
                          <div className="bg-white p-4 rounded-lg border border-gray-200">
                            <div className="flex items-center justify-between mb-4">
                              <div>
                                <div className="text-sm text-red-600 font-medium mb-1">
                                  ë§¥íŒŒ ê¸°ë°˜ ì‹ ì²´ê±´ê°• ì ìˆ˜
                                </div>
                                <div className="text-2xl font-bold text-gray-900">
                                  {analysisResult.detailedAnalysis.physicalHealth.score}ì 
                                </div>
                              </div>
                              <div>
                                <Badge className={getScoreBadgeColor(analysisResult.detailedAnalysis.physicalHealth.score)}>
                                  {analysisResult.detailedAnalysis.physicalHealth.status}
                                </Badge>
                              </div>
                            </div>
                            
                            {/* ì ìˆ˜ ë¶„í¬ í‘œì‹œ */}
                            <ScoreDistributionBar 
                              score={analysisResult.detailedAnalysis.physicalHealth.score} 
                              label="ì‹ ì²´ê±´ê°• ì ìˆ˜"
                            />
                            
                            <div className="mt-4 prose prose-sm max-w-none prose-gray">
                              <h4 className="text-base font-semibold text-gray-900 mb-2">í•´ì„</h4>
                              {loadingPhysicalComprehensive ? (
                                <div className="flex items-center gap-2 p-4 bg-gray-50 rounded-lg">
                                  <Loader2 className="w-4 h-4 animate-spin text-gray-500" />
                                  <span className="text-sm text-gray-600">ë§¥íŒŒ ë¶„ì„ ì¢…í•© í•´ì„ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
                                </div>
                              ) : physicalHealthComprehensive ? (
                                <AIAnalysisMarkdownRenderer content={physicalHealthComprehensive.comprehensiveInterpretation} />
                              ) : (
                                <div className="text-gray-600">
                                  AI í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                                </div>
                              )}
                            </div>
                          </div>
                        </div>

                        {/* 2. ê°œì¸í™”ëœ ë§¥íŒŒ ë¶„ì„ í‰ê°€ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ê°œì¸í™”ëœ ë§¥íŒŒ ë¶„ì„ í‰ê°€
                          </h3>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {/* ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Users className="w-4 h-4 text-blue-600" />
                                ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì—°ë ¹ëŒ€:</span>
                                  <span className="font-medium">{report.personalInfo.age}ì„¸</span>
                                </div>
                                <div className="flex justify-between">
                                  <span>ì„±ë³„:</span>
                                  <span className="font-medium">{report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}</span>
                                </div>
                                <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                                  {loadingPhysicalComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-blue-600" />
                                      <span className="text-sm text-blue-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : physicalHealthComprehensive ? (
                                    <div className="space-y-2">
                                      <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì—°ë ¹ëŒ€ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{physicalHealthComprehensive.ageSpecificAnalysis.typicalCharacteristics}</p>
                                      </div>
                                      <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì„±ë³„ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{physicalHealthComprehensive.genderSpecificAnalysis.cardiovascularCharacteristics}</p>
                                      </div>
                                    </div>
                                  ) : (
                                    <p className="text-sm text-blue-800">
                                      {`${report.personalInfo.age}ì„¸ ${report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}ì˜ ë§¥íŒŒ íŒ¨í„´ì„ ë¶„ì„í•œ ê²°ê³¼, í•´ë‹¹ ì—°ë ¹ëŒ€ì™€ ì„±ë³„ì˜ ì¼ë°˜ì ì¸ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ê°œì¸í™”ëœ ì‹¬í˜ˆê´€ ê±´ê°• í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`}
                                    </p>
                                  )}
                                </div>
                              </div>
                            </div>

                            {/* ì§ì—…ì  íŠ¹ì„± ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Briefcase className="w-4 h-4 text-green-600" />
                                ì§ì—…ì  íŠ¹ì„± ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì§ì—…:</span>
                                  <span className="font-medium">{getOccupationLabel(report.personalInfo.occupation)}</span>
                                </div>
                                <div className="mt-3 p-3 bg-green-50 rounded-lg">
                                  {loadingPhysicalComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-green-600" />
                                      <span className="text-sm text-green-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : physicalHealthComprehensive ? (
                                    <div className="space-y-2">
                                      <div>
                                        <h5 className="text-xs font-medium text-green-900 mb-1">ì§ì—… ìš”êµ¬ì‚¬í•­:</h5>
                                        <p className="text-sm text-green-800">{physicalHealthComprehensive.occupationalAnalysis.workRequirements}</p>
                                      </div>
                                    </div>
                                  ) : (
                                    <p className="text-sm text-green-800">
                                      {`${getOccupationLabel(report.personalInfo.occupation)} ì§ì—…ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ë§¥íŒŒ ê¸°ë°˜ ì‹¬í˜ˆê´€ ê±´ê°• ìƒíƒœë¥¼ ë¶„ì„í•˜ê³  ì§ì—…ì  ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ê°œì¸í™”ëœ í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`}
                                    </p>
                                  )}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        {/* ë§¥íŒŒ ì§€í‘œ ìƒì„¸ í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ë§¥íŒŒ ì§€í‘œ ìƒì„¸ í•´ì„
                          </h3>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {preparePPGMetrics().map((metric, index) => (
                              <Card key={index} className={`${getEEGCardBackgroundClass(metric.status)} shadow-sm`}>
                                <CardHeader className="pb-3">
                                    <div>
                                      <CardTitle className="text-base font-semibold text-gray-900">
                                        {metric.title}
                                      </CardTitle>
                                      <p className="text-sm text-gray-500">{metric.subtitle}</p>
                                  </div>
                                </CardHeader>
                                <CardContent>
                                  <div className="space-y-1">
                                    {/* ê·¸ë˜í”„ */}
                                    <div className="flex justify-center">
                                      <div className="w-96">
                                      <EEGMetricChart
                                        value={metric.value}
                                        normalRange={metric.normalRange}
                                        label={metric.title}
                                        unit={metric.unit}
                                        status={metric.status}
                                        customLabels={metric.customLabels}
                                      />
                                      </div>
                                    </div>
                                    
                                    {/* í•˜ë‹¨: í•´ì„ */}
                                    <div className="border-t border-gray-100 pt-2 mt-2">
                                      <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                        <p className="text-sm text-gray-600 leading-relaxed">
                                          {metric.interpretation}
                                        </p>
                                    </div>
                                  </div>
                                </CardContent>
                              </Card>
                            ))}
                          </div>
                        </div>

                        {/* ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥ */}
                        {physicalHealthComprehensive && (
                          <div className="space-y-4">
                            <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                              ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥
                            </h3>
                            
                            <div className="grid grid-cols-1 gap-4">
                              {/* ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜ */}
                              <div className="bg-white p-4 rounded-lg border border-gray-200">
                                <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                  <Zap className="w-4 h-4 text-red-600" />
                                  ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜
                                </h4>
                                <ul className="space-y-2">
                                  {physicalHealthComprehensive.personalizedRecommendations.immediate.map((item: string, index: number) => (
                                    <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                      <span className="text-red-500 mt-1">â€¢</span>
                                      <span>{item}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>

                              {/* ë‹¨ê¸° ëª©í‘œ (1-4ì£¼) */}
                              <div className="bg-white p-4 rounded-lg border border-gray-200">
                                <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                  <Target className="w-4 h-4 text-blue-600" />
                                  ë‹¨ê¸° ëª©í‘œ (1-4ì£¼)
                                </h4>
                                <ul className="space-y-2">
                                  {physicalHealthComprehensive.personalizedRecommendations.shortTerm.map((item: string, index: number) => (
                                    <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                      <span className="text-blue-500 mt-1">â€¢</span>
                                      <span>{item}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>

                              {/* ì¥ê¸° ì „ëµ (1-6ê°œì›”) */}
                              <div className="bg-white p-4 rounded-lg border border-gray-200">
                                <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                  <TrendingUp className="w-4 h-4 text-purple-600" />
                                  ì¥ê¸° ì „ëµ (1-6ê°œì›”)
                                </h4>
                                <ul className="space-y-2">
                                  {physicalHealthComprehensive.personalizedRecommendations.longTerm.map((item: string, index: number) => (
                                    <li key={index} className="text-sm text-gray-700 flex items-start gap-2">
                                      <span className="text-purple-500 mt-1">â€¢</span>
                                      <span>{item}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>
                            </div>
                          </div>
                        )}
                      </CardContent>
                    </Card>
                  )}

                  {/* ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ */}
                  {analysisResult.detailedAnalysis?.stressLevel && (
                    <Card className="bg-gray-50 border-gray-200">
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-gray-900">
                          <Zap className="w-5 h-5 text-yellow-600" />
                          âš¡ ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ê²°ê³¼
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-8">
                        
                        {/* 1. ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„
                          </h3>
                          
                          <div className="bg-white p-4 rounded-lg border border-gray-200">
                            <div className="flex items-center justify-between mb-4">
                              <div>
                                <div className="text-sm font-medium text-yellow-600 mb-1">
                                  ìŠ¤íŠ¸ë ˆìŠ¤ ì ìˆ˜
                                </div>
                                <div className="text-2xl font-bold text-gray-900">
                                  {analysisResult.detailedAnalysis.stressLevel.score}ì 
                                </div>
                              </div>
                              <div>
                                <Badge className={getScoreBadgeColor(analysisResult.detailedAnalysis.stressLevel.score)}>
                                  {analysisResult.detailedAnalysis.stressLevel.level}
                                </Badge>
                              </div>
                            </div>
                            
                            {/* ì ìˆ˜ ë¶„í¬ í‘œì‹œ */}
                            <ScoreDistributionBar 
                              score={analysisResult.detailedAnalysis.stressLevel.score} 
                              label="ìŠ¤íŠ¸ë ˆìŠ¤ ì ìˆ˜"
                            />
                            
                            <div className="mt-4 prose prose-sm max-w-none prose-gray">
                              <h4 className="text-base font-semibold text-gray-900 mb-2">í•´ì„</h4>
                              {loadingStressComprehensive ? (
                                <div className="flex items-center gap-2 p-4 bg-gray-50 rounded-lg">
                                  <Loader2 className="w-4 h-4 animate-spin text-gray-500" />
                                  <span className="text-sm text-gray-600">ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ ì¢…í•© í•´ì„ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
                            </div>
                              ) : stressComprehensive ? (
                                <AIAnalysisMarkdownRenderer content={stressComprehensive.comprehensiveInterpretation} />
                              ) : (
                                <div className="text-gray-600">
                                  AI í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                                </div>
                              )}
                            </div>
                          </div>
                        </div>

                        {/* 2. ê°œì¸í™”ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ í‰ê°€ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ê°œì¸í™”ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ë¶„ì„ í‰ê°€
                          </h3>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {/* ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Users className="w-4 h-4 text-blue-600" />
                                ì—°ë ¹ë³„/ì„±ë³„ë³„ íŠ¹ì„±ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì—°ë ¹ëŒ€:</span>
                                  <span className="font-medium">{report.personalInfo.age}ì„¸</span>
                                </div>
                                <div className="flex justify-between">
                                  <span>ì„±ë³„:</span>
                                  <span className="font-medium">{report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}</span>
                                </div>
                                <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                                  {loadingStressComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-blue-600" />
                                      <span className="text-sm text-blue-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : stressComprehensive ? (
                                    <div className="space-y-2">
                                <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì—°ë ¹ëŒ€ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{stressComprehensive.ageSpecificAnalysis.typicalCharacteristics}</p>
                                </div>
                                <div>
                                        <h5 className="text-xs font-medium text-blue-900 mb-1">ì„±ë³„ íŠ¹ì„±:</h5>
                                        <p className="text-sm text-blue-800">{stressComprehensive.genderSpecificAnalysis.stressPatternCharacteristics}</p>
                                      </div>
                                    </div>
                                  ) : (
                                    <p className="text-sm text-blue-800">
                                      {`${report.personalInfo.age}ì„¸ ${report.personalInfo.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ íŒ¨í„´ì„ ë¶„ì„í•œ ê²°ê³¼, í•´ë‹¹ ì—°ë ¹ëŒ€ì™€ ì„±ë³„ì˜ ì¼ë°˜ì ì¸ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ê°œì¸í™”ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`}
                                  </p>
                                  )}
                                </div>
                              </div>
                            </div>

                            {/* ì§ì—…ì  íŠ¹ì„± ë¶„ì„ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Briefcase className="w-4 h-4 text-green-600" />
                                ì§ì—…ì  íŠ¹ì„± ë¶„ì„
                              </h4>
                              <div className="space-y-3 text-sm text-gray-600">
                                <div className="flex justify-between">
                                  <span>ì§ì—…:</span>
                                  <span className="font-medium">{getOccupationLabel(report.personalInfo.occupation)}</span>
                                </div>
                                <div className="mt-3 p-3 bg-green-50 rounded-lg">
                                  {loadingStressComprehensive ? (
                                    <div className="flex items-center gap-2">
                                      <Loader2 className="w-3 h-3 animate-spin text-green-600" />
                                      <span className="text-sm text-green-800">ë¶„ì„ ì¤‘...</span>
                                    </div>
                                  ) : stressComprehensive ? (
                                    <div className="space-y-2">
                                <div>
                                        <h5 className="text-xs font-medium text-green-900 mb-1">ì§ì—… ìš”êµ¬ì‚¬í•­:</h5>
                                        <p className="text-sm text-green-800">{stressComprehensive.occupationalAnalysis.workRequirements}</p>
                                      </div>
                                    </div>
                                  ) : (
                                    <p className="text-sm text-green-800">
                                      {`${getOccupationLabel(report.personalInfo.occupation)} ì§ì—…ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ìƒíƒœë¥¼ ë¶„ì„í•˜ê³  ì§ì—…ì  ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ê°œì¸í™”ëœ í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`}
                                    </p>
                                  )}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        {/* 3. ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ ìƒì„¸ í•´ì„ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ ìƒì„¸ í•´ì„
                          </h3>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {/* ë‡ŒíŒŒ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) >= 3.0 && 
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 4.0 ? 'normal' : 
                              (report.measurementData.eegMetrics.stressIndex?.value || 0) < 3.0 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                <div className="flex items-center justify-between">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ë‡ŒíŒŒ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">EEG Stress Index</p>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-lg font-bold text-gray-900">
                                      {report.measurementData.eegMetrics.stressIndex?.value?.toFixed(2) || 'N/A'}
                                    </div>
                                    <Badge 
                                      variant="outline" 
                                      className={
                                        (report.measurementData.eegMetrics.stressIndex?.value || 0) >= 3.0 && 
                                        (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 4.0
                                          ? 'border-green-300 text-green-700 bg-green-50' 
                                          : (report.measurementData.eegMetrics.stressIndex?.value || 0) > 4.0
                                          ? 'border-red-300 text-red-700 bg-red-50'
                                          : 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                      }
                                    >
                                      {(report.measurementData.eegMetrics.stressIndex?.value || 0) >= 3.0 && 
                                       (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 4.0 ? 'ì •ìƒ' : 
                                       (report.measurementData.eegMetrics.stressIndex?.value || 0) > 4.0 ? 'ë†’ìŒ' : 'ë‚®ìŒ'}
                                    </Badge>
                                  </div>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-4">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96 h-96">
                                      <EEGMetricChart
                                        value={report.measurementData.eegMetrics.stressIndex?.value || 0}
                                        normalRange={{ min: 3.0, max: 4.0 }}
                                        label="ë‡ŒíŒŒ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜"
                                        unit=""
                                        status={
                                          (report.measurementData.eegMetrics.stressIndex?.value || 0) >= 3.0 && 
                                          (report.measurementData.eegMetrics.stressIndex?.value || 0) <= 4.0 ? 'normal' : 
                                          (report.measurementData.eegMetrics.stressIndex?.value || 0) > 4.0 ? 'high' : 'low'
                                        }
                                      />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-100 pt-3">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                      ë² íƒ€íŒŒì™€ ê°ë§ˆíŒŒì˜ ë¹„ìœ¨ë¡œ ì¸¡ì •ë˜ë©°, ì •ì‹ ì  ê¸´ì¥ë„ì™€ ê°ì„± ìƒíƒœë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.
                                    </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ììœ¨ì‹ ê²½ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ (LF/HF ë¹„ìœ¨) */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) >= 1.0 && 
                              (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) <= 10.0 ? 'normal' : 
                              (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) < 1.0 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                <div className="flex items-center justify-between">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ììœ¨ì‹ ê²½ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€í‘œ (LF/HF ë¹„ìœ¨)
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Autonomic Stress Index</p>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-lg font-bold text-gray-900">
                                      {report.measurementData.ppgMetrics.lfHfRatio?.value?.toFixed(2) || 'N/A'}
                                    </div>
                                    <Badge 
                                      variant="outline" 
                                      className={
                                        (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) >= 1.0 && 
                                        (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) <= 10.0
                                          ? 'border-green-300 text-green-700 bg-green-50' 
                                          : 'border-orange-300 text-orange-700 bg-orange-50'
                                      }
                                    >
                                      {(report.measurementData.ppgMetrics.lfHfRatio?.value || 0) >= 1.0 && 
                                       (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) <= 10.0 ? 'ê· í˜• ìƒíƒœ' : 'ë¶ˆê· í˜•'}
                                    </Badge>
                                  </div>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-4">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96 h-96">
                                      <EEGMetricChart
                                        value={report.measurementData.ppgMetrics.lfHfRatio?.value || 0}
                                        normalRange={{ min: 1.0, max: 10.0 }}
                                        label="LF/HF ë¹„ìœ¨"
                                        unit=""
                                        status={
                                          (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) >= 1.0 && 
                                          (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) <= 10.0 ? 'normal' : 
                                          (report.measurementData.ppgMetrics.lfHfRatio?.value || 0) > 10.0 ? 'high' : 'low'
                                        }
                                      />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-100 pt-3">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                      êµê°ì‹ ê²½ê³¼ ë¶€êµê°ì‹ ê²½ì˜ ê· í˜•ì„ ë‚˜íƒ€ë‚´ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ì— ëŒ€í•œ ì‹ ì²´ ë°˜ì‘ì„ í‰ê°€í•©ë‹ˆë‹¤.
                                    </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µë ¥ (RMSSD) */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.ppgMetrics.rmssd?.value || 0) >= 20 && 
                              (report.measurementData.ppgMetrics.rmssd?.value || 0) <= 50 ? 'normal' : 
                              (report.measurementData.ppgMetrics.rmssd?.value || 0) < 20 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                <div className="flex items-center justify-between">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µë ¥ (RMSSD)
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Stress Recovery</p>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-lg font-bold text-gray-900">
                                      {report.measurementData.ppgMetrics.rmssd?.value?.toFixed(0) || 'N/A'}
                                      <span className="text-sm text-gray-500 ml-1">ms</span>
                                    </div>
                                    <Badge 
                                      variant="outline" 
                                      className={
                                        (report.measurementData.ppgMetrics.rmssd?.value || 0) >= 20 && 
                                        (report.measurementData.ppgMetrics.rmssd?.value || 0) <= 50
                                          ? 'border-green-300 text-green-700 bg-green-50' 
                                          : (report.measurementData.ppgMetrics.rmssd?.value || 0) < 20
                                          ? 'border-red-300 text-red-700 bg-red-50'
                                          : 'border-blue-300 text-blue-700 bg-blue-50'
                                      }
                                    >
                                      {(report.measurementData.ppgMetrics.rmssd?.value || 0) >= 20 && 
                                       (report.measurementData.ppgMetrics.rmssd?.value || 0) <= 50 ? 'ì •ìƒ' : 
                                       (report.measurementData.ppgMetrics.rmssd?.value || 0) < 20 ? 'ë‚®ìŒ' : 'ë†’ì€ íšŒë³µë ¥'}
                                    </Badge>
                                  </div>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-4">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96 h-96">
                                      <EEGMetricChart
                                        value={report.measurementData.ppgMetrics.rmssd?.value || 0}
                                        normalRange={{ min: 20, max: 50 }}
                                        label="RMSSD"
                                        unit="ms"
                                        status={
                                          (report.measurementData.ppgMetrics.rmssd?.value || 0) >= 20 && 
                                          (report.measurementData.ppgMetrics.rmssd?.value || 0) <= 50 ? 'normal' : 
                                          (report.measurementData.ppgMetrics.rmssd?.value || 0) < 20 ? 'low' : 'high'
                                        }
                                      />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-100 pt-3">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                      ë¶€êµê°ì‹ ê²½ í™œì„±ë„ë¥¼ ë‚˜íƒ€ë‚´ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™©ì—ì„œì˜ íšŒë³µ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.
                                    </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì‹¬ë°•ìˆ˜ ë°˜ì‘ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.ppgMetrics.heartRate?.value || 0) >= 60 && 
                              (report.measurementData.ppgMetrics.heartRate?.value || 0) <= 100 ? 'normal' : 
                              (report.measurementData.ppgMetrics.heartRate?.value || 0) < 60 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                <div className="flex items-center justify-between">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì‹¬ë°•ìˆ˜ ë°˜ì‘
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Heart Rate Response</p>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-lg font-bold text-gray-900">
                                      {report.measurementData.ppgMetrics.heartRate?.value?.toFixed(0) || 'N/A'}
                                      <span className="text-sm text-gray-500 ml-1">BPM</span>
                                    </div>
                                    <Badge 
                                      variant="outline" 
                                      className={
                                        (report.measurementData.ppgMetrics.heartRate?.value || 0) >= 60 && 
                                        (report.measurementData.ppgMetrics.heartRate?.value || 0) <= 100
                                          ? 'border-green-300 text-green-700 bg-green-50' 
                                          : (report.measurementData.ppgMetrics.heartRate?.value || 0) > 100
                                          ? 'border-red-300 text-red-700 bg-red-50'
                                          : 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                      }
                                    >
                                      {(report.measurementData.ppgMetrics.heartRate?.value || 0) >= 60 && 
                                       (report.measurementData.ppgMetrics.heartRate?.value || 0) <= 100 ? 'ì •ìƒ' : 
                                       (report.measurementData.ppgMetrics.heartRate?.value || 0) > 100 ? 'ë†’ìŒ' : 'ë‚®ìŒ'}
                                    </Badge>
                                  </div>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-4">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96 h-96">
                                      <EEGMetricChart
                                        value={report.measurementData.ppgMetrics.heartRate?.value || 0}
                                        normalRange={{ min: 60, max: 100 }}
                                        label="ì‹¬ë°•ìˆ˜"
                                        unit="BPM"
                                        status={
                                          (report.measurementData.ppgMetrics.heartRate?.value || 0) >= 60 && 
                                          (report.measurementData.ppgMetrics.heartRate?.value || 0) <= 100 ? 'normal' : 
                                          (report.measurementData.ppgMetrics.heartRate?.value || 0) > 100 ? 'high' : 'low'
                                        }
                                      />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-100 pt-3">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                      ì‹¬í˜ˆê´€ê³„ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ì„ ë‚˜íƒ€ë‚´ë©°, ì‹ ì²´ì  ê¸´ì¥ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.
                                    </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>

                            {/* ì •ì‹ ì  ì´ì™„ë„ */}
                            <Card className={`${getEEGCardBackgroundClass(
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22 ? 'normal' : 
                              (report.measurementData.eegMetrics.relaxationIndex?.value || 0) < 0.18 ? 'low' : 'high'
                            )} shadow-sm`}>
                              <CardHeader className="pb-3">
                                <div className="flex items-center justify-between">
                                  <div>
                                    <CardTitle className="text-base font-semibold text-gray-900">
                                      ì •ì‹ ì  ì´ì™„ë„
                                    </CardTitle>
                                    <p className="text-sm text-gray-500">Mental Relaxation</p>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-lg font-bold text-gray-900">
                                      {report.measurementData.eegMetrics.relaxationIndex?.value?.toFixed(3) || 'N/A'}
                                    </div>
                                    <Badge 
                                      variant="outline" 
                                      className={
                                        (report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                                        (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22
                                          ? 'border-green-300 text-green-700 bg-green-50' 
                                          : (report.measurementData.eegMetrics.relaxationIndex?.value || 0) > 0.22
                                          ? 'border-red-300 text-red-700 bg-red-50'
                                          : 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                      }
                                    >
                                      {(report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                                       (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22 ? 'ì •ìƒ' : 
                                       (report.measurementData.eegMetrics.relaxationIndex?.value || 0) > 0.22 ? 'ë†’ìŒ' : 'ë‚®ìŒ'}
                                    </Badge>
                                  </div>
                                </div>
                              </CardHeader>
                              <CardContent>
                                <div className="space-y-4">
                                  {/* ê·¸ë˜í”„ */}
                                  <div className="flex justify-center">
                                    <div className="w-96 h-96">
                                      <EEGMetricChart
                                        value={report.measurementData.eegMetrics.relaxationIndex?.value || 0}
                                        normalRange={{ min: 0.18, max: 0.22 }}
                                        label="ì •ì‹ ì  ì´ì™„ë„"
                                        unit=""
                                        status={
                                          (report.measurementData.eegMetrics.relaxationIndex?.value || 0) >= 0.18 && 
                                          (report.measurementData.eegMetrics.relaxationIndex?.value || 0) <= 0.22 ? 'normal' : 
                                          (report.measurementData.eegMetrics.relaxationIndex?.value || 0) > 0.22 ? 'high' : 'low'
                                        }
                                      />
                                    </div>
                                  </div>
                                  
                                  {/* í•˜ë‹¨: í•´ì„ */}
                                  <div className="border-t border-gray-100 pt-3">
                                    <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                      ì•ŒíŒŒíŒŒ ê¸°ë°˜ ì •ì‹ ì  ì´ì™„ ëŠ¥ë ¥ì„ ë‚˜íƒ€ë‚´ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.
                                    </p>
                                  </div>
                                </div>
                              </CardContent>
                            </Card>
                          </div>
                        </div>

                        {/* 4. ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥ */}
                        <div className="space-y-4">
                          <h3 className="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                            ê¶Œì¥ ì‚¬í•­ ë° ê°œì„  ë°©í–¥
                          </h3>
                          
                          <div className="space-y-4">
                            {/* ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜ */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Zap className="w-4 h-4 text-red-600" />
                                ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜
                              </h4>
                              <div className="prose prose-sm max-w-none prose-gray">
                                <AIAnalysisMarkdownRenderer 
                                  content={`**ì‹¬í˜¸í¡ ë° ì§§ì€ëª…ìƒ**: 1ì¼ 3íšŒ, ê° 5ë¶„ì”© ì‹¬í˜¸í¡ ë° ëª…ìƒ ê¸°ë²• ì‹¤ì‹œë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”

**ê·œì¹™ì ì¸ ìˆ˜ë©´ íŒ¨í„´**: 7-8ì‹œê°„ ìˆ˜ë©´ ì‹œê°„ í™•ë³´ ë° ì¼ì •í•œ ì·¨ì¹¨/ê¸°ìƒ ì‹œê°„ ìœ ì§€

**ì¹´í˜ì¸ ì„­ì·¨ ì œí•œ**: í•˜ë£¨ 2ì” ì´í•˜ë¡œ ì œí•œí•˜ì—¬ ìˆ˜ë©´ ì§ˆ ê°œì„  ë° ë¶ˆì•ˆê° ê°ì†Œ

**ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™© ì¸ì‹**: ìŠ¤íŠ¸ë ˆìŠ¤ ìœ ë°œ ìš”ì¸ íŒŒì•… ë° ì¦‰ì‹œ ëŒ€ì²˜ ë°©ì•ˆ ìˆ˜ë¦½`}
                                  variant="compact"
                                />
                              </div>
                            </div>

                            {/* ë‹¨ê¸° ëª©í‘œ (1-4ì£¼) */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <Target className="w-4 h-4 text-blue-600" />
                                ë‹¨ê¸° ëª©í‘œ (1-4ì£¼)
                              </h4>
                              <div className="prose prose-sm max-w-none prose-gray">
                                <AIAnalysisMarkdownRenderer 
                                  content={`**ì •ê¸°ì ì¸ ìš´ë™ ë£¨í‹´**: ì£¼ 3íšŒ, 30ë¶„ì”© ìœ ì‚°ì†Œ ìš´ë™ìœ¼ë¡œ ì‹¬í˜ˆê´€ ê±´ê°• ë° ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬

**ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ê¸°ë²•**: ëª…ìƒ, ìš”ê°€, í˜¸í¡ë²• ë“± ì²´ê³„ì  ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë°©ë²• í•™ìŠµ ë° ì ìš©

**ì—…ë¬´ í™˜ê²½ ê°œì„ **: íœ´ì‹ ì‹œê°„ í™•ë³´, ì‘ì—… ê³µê°„ ì •ë¦¬, ì—…ë¬´ íš¨ìœ¨ì„± í–¥ìƒ

**ì‚¬íšŒì  ì§€ì§€ ì²´ê³„**: ê°€ì¡±, ì¹œêµ¬ì™€ì˜ ì†Œí†µ ê°•í™” ë° ì •ì„œì  ì§€ì› ì²´ê³„ êµ¬ì¶•`}
                                  variant="compact"
                                />
                              </div>
                            </div>

                            {/* ì¥ê¸° ì „ëµ (1-6ê°œì›”) */}
                            <div className="bg-white p-4 rounded-lg border border-gray-200">
                              <h4 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                <TrendingUp className="w-4 h-4 text-purple-600" />
                                ì¥ê¸° ì „ëµ (1-6ê°œì›”)
                              </h4>
                              <div className="prose prose-sm max-w-none prose-gray">
                                <AIAnalysisMarkdownRenderer 
                                  content={`**ì „ë¬¸ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬**: ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ í”„ë¡œê·¸ë¨ ì°¸ì—¬ ë° ì „ë¬¸ê°€ ìƒë‹´

**ì •ê¸°ì ì¸ ê±´ê°• ëª¨ë‹ˆí„°ë§**: ê±´ê°• ê²€ì§„ ë° ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ ì§€ì†ì  ëª¨ë‹ˆí„°ë§

**ë¼ì´í”„ìŠ¤íƒ€ì¼ ì „ë°˜ì  ê°œì„ **: ì‹ìŠµê´€, ìš´ë™, ì·¨ë¯¸ í™œë™ ë“± ì „ë°˜ì  ìƒí™œ íŒ¨í„´ ê°œì„ 

**ì‹¬ë¦¬ì  ì§€ì› ì²´ê³„**: ì‹¬ë¦¬ ìƒë‹´ ë˜ëŠ” ì½”ì¹­ í”„ë¡œê·¸ë¨ì„ í†µí•œ ì¥ê¸°ì  ì •ì‹ ê±´ê°• ê´€ë¦¬`}
                                  variant="compact"
                                />
                              </div>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  )}
                </div>
              </div>
            </CardContent>
          )}
        </Card>

        {/* 3ë‹¨ê³„: ì •ì‹  ê±´ê°• ìœ„í—˜ë„ ë¶„ì„ */}
        <Card className="bg-white border-gray-200 shadow-sm">
          <CardHeader 
            className="cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-200"
            onClick={() => setExpandedSections(prev => ({
              ...prev,
              mentalHealthRisk: !prev.mentalHealthRisk
            }))}
          >
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                  <span className="text-purple-600 font-semibold text-sm">3</span>
                </div>
                <div>
                  <CardTitle className="text-lg text-gray-900">ì •ì‹  ê±´ê°• ìœ„í—˜ë„ ë¶„ì„</CardTitle>
                  <CardDescription className="text-gray-600">
                    ìš°ìš¸, ADHD, ë²ˆì•„ì›ƒ, ì¶©ë™ì„± ìœ„í—˜ë„ í‰ê°€
                  </CardDescription>
                </div>
              </div>
              {expandedSections.mentalHealthRisk ? (
                <ChevronUp className="w-5 h-5 text-gray-500" />
              ) : (
                <ChevronDown className="w-5 h-5 text-gray-500" />
              )}
            </div>
          </CardHeader>
          
          {expandedSections.mentalHealthRisk && (
            <CardContent className="p-6 bg-white">
              <div className="space-y-6">
                {/* ì¢…í•© ìœ„í—˜ë„ í‰ê°€ */}
                <Card className="border border-gray-200">
                  <CardHeader className="bg-white border-b border-gray-200">
                    <CardTitle className="flex items-center gap-2 text-gray-900">
                      ì¢…í•© ìœ„í—˜ë„ í‰ê°€
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="p-4">
                    <div className="space-y-4">
                      {/* ì „ì²´ ìœ„í—˜ë„ ì ìˆ˜ ê³„ì‚° - PDFì™€ ë™ì¼í•œ ë°©ì‹ */}
                      {(() => {
                        const riskData = {
                          depression: analysisResult.detailedAnalysis?.mentalHealthRisk?.depression?.riskScore || 25,
                          adhd: analysisResult.detailedAnalysis?.mentalHealthRisk?.adhd?.riskScore || 30,
                          burnout: analysisResult.detailedAnalysis?.mentalHealthRisk?.burnout?.riskScore || 35,
                          impulsivity: analysisResult.detailedAnalysis?.mentalHealthRisk?.impulsivity?.riskScore || 28
                        };
                        const overallRisk = Math.max(...Object.values(riskData));
                                                  const riskLevel = overallRisk < 5 ? 'ìœ„í—˜' : overallRisk < 25 ? 'ê²½ê³„' : overallRisk < 75 ? 'ë³´í†µ' : overallRisk < 95 ? 'ì–‘í˜¸' : 'ìš°ìˆ˜';
                                                      const riskColor = overallRisk < 5 ? 'text-red-600' : overallRisk < 25 ? 'text-orange-600' : overallRisk < 75 ? 'text-yellow-600' : overallRisk < 95 ? 'text-green-600' : 'text-blue-600';
                        
                        return (
                          <div className="space-y-4">
                            <div className="flex items-center justify-between">
                              <span className="text-sm font-medium text-gray-700">ì „ì²´ ìœ„í—˜ë„ ì ìˆ˜</span>
                              <span className={`text-lg font-bold ${riskColor}`}>
                                {overallRisk.toFixed(1)}/100
                              </span>
                            </div>
                            {/* ê°œì„ ëœ Progress Bar */}
                            <div className="space-y-2">
                              <div className="relative">
                                {/* ì „ì²´ êµ¬ê°„ ìƒ‰ìƒ í‘œì‹œ (ê³ ì •) */}
                                                            <div className="w-full h-4 overflow-hidden bg-gradient-to-r from-red-500 via-orange-400 via-yellow-400 via-green-400 to-blue-500">
                              {/* êµ¬ê°„ ê²½ê³„ì„  - 5ë‹¨ê³„ */}
                              <div className="absolute top-0 left-[5%] w-px h-4 bg-white opacity-50"></div>
                              <div className="absolute top-0 left-[25%] w-px h-4 bg-white opacity-50"></div>
                              <div className="absolute top-0 left-[75%] w-px h-4 bg-white opacity-50"></div>
                              <div className="absolute top-0 left-[95%] w-px h-4 bg-white opacity-50"></div>
                            </div>
                                
                                {/* í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ */}
                                <div 
                                  className="absolute top-0 w-1 h-4 bg-gray-900 transition-all duration-500 shadow-lg"
                                  style={{ left: `${overallRisk}%`, transform: 'translateX(-50%)' }}
                                />
                                
                                {/* í˜„ì¬ ìœ„ì¹˜ í‘œì‹œì  */}
                                <div 
                                  className="absolute top-1/2 w-3 h-3 bg-white border-2 border-gray-900 transition-all duration-500 shadow-lg"
                                  style={{ left: `${overallRisk}%`, transform: 'translate(-50%, -50%)' }}
                                />
                                
                                {/* ì ìˆ˜ ë° ìƒíƒœ í‘œì‹œ íˆ´íŒ */}
                                <div 
                                  className="absolute -top-12 bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap transition-all duration-500"
                                  style={{ left: `${overallRisk}%`, transform: 'translateX(-50%)' }}
                                >
                                  <div className="text-center">
                                    <div className="font-bold">{overallRisk.toFixed(1)}ì </div>
                                    <div className="text-xs opacity-90">
                                      {overallRisk < 5 ? 'ìœ„í—˜' : overallRisk < 25 ? 'ê²½ê³„' : overallRisk < 75 ? 'ë³´í†µ' : overallRisk < 95 ? 'ì–‘í˜¸' : 'ìš°ìˆ˜'}
                                    </div>
                                  </div>
                                  {/* í™”ì‚´í‘œ */}
                                  <div className="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-4 border-transparent border-t-gray-900"></div>
                                </div>
                              </div>
                              
                              {/* êµ¬ê°„ ë¼ë²¨ */}
                              <div className="flex justify-between text-xs text-gray-600 px-1">
                                                            <span className="text-red-600 font-medium">ìœ„í—˜ (0-5)</span>
                            <span className="text-orange-600 font-medium">ê²½ê³„ (5-25)</span>
                            <span className="text-yellow-600 font-medium">ë³´í†µ (25-75)</span>
                            <span className="text-green-600 font-medium">ì–‘í˜¸ (75-95)</span>
                            <span className="text-blue-600 font-medium">ìš°ìˆ˜ (95-100)</span>
                              </div>
                            </div>
                            <div className={`text-sm font-medium ${riskColor}`}>
                              ìœ„í—˜ ìˆ˜ì¤€: {riskLevel}
                            </div>
                            
                            <div className="bg-purple-50 rounded-lg p-3">
                              <h5 className="font-medium text-purple-800 mb-2">ğŸ§  ì •ì‹ ê±´ê°• ì „ë¬¸ê°€ ê¶Œì¥ì‚¬í•­</h5>
                              <div className="prose prose-sm max-w-none prose-purple mb-3">
                                <AIAnalysisMarkdownRenderer 
                                  content="**ì¢…í•© ìœ„í—˜ë„ í‰ê°€:** í˜„ì¬ ì •ì‹ ê±´ê°• ìƒíƒœëŠ” ë‹¤ê°ì  ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ë‡ŒíŒŒ(EEG) ë° ì‹¬í˜ˆê´€(PPG) ë°”ì´ì˜¤ë§ˆì»¤ë¥¼ ì¢…í•©í•˜ì—¬ ê°œì¸ë³„ ë§ì¶¤í˜• ê´€ë¦¬ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤."
                                  variant="compact"
                                />
                              </div>
                              
                              <div className="grid grid-cols-1 gap-3 text-sm">
                                <div className="bg-blue-50 p-3 rounded-lg">
                                  <div className="font-medium text-blue-800 mb-1">ğŸ”µ ìš°ìš¸ ì˜ˆë°© ê´€ë¦¬</div>
                                  <div className="prose prose-xs max-w-none prose-blue">
                                    <AIAnalysisMarkdownRenderer 
                                      content="ì „ë‘ì—½ ì•ŒíŒŒ ë¹„ëŒ€ì¹­ì„±ê³¼ ì„¸íƒ€íŒŒ í™œë™ íŒ¨í„´ì„ í†µí•œ ì¡°ê¸° ê°ì§€ ë° ì¸ì§€í–‰ë™ì¹˜ë£Œ ê¸°ë°˜ ê°œì…"
                                      variant="compact"
                                    />
                                  </div>
                                </div>
                                
                                <div className="bg-green-50 p-3 rounded-lg">
                                  <div className="font-medium text-green-800 mb-1">ğŸ¯ ì§‘ì¤‘ë ¥ í–¥ìƒ ê´€ë¦¬</div>
                                  <div className="prose prose-xs max-w-none prose-green">
                                    <AIAnalysisMarkdownRenderer 
                                      content="ì£¼ì˜ì§‘ì¤‘ ì§€ìˆ˜ì™€ ê³¼í™œì„± ì§€ìˆ˜ ìµœì í™”ë¥¼ í†µí•œ ì‹¤í–‰ê¸°ëŠ¥ ê°•í™” ë° ìê¸°ì¡°ì ˆëŠ¥ë ¥ í–¥ìƒ"
                                      variant="compact"
                                    />
                                  </div>
                                </div>
                                
                                <div className="bg-orange-50 p-3 rounded-lg">
                                  <div className="font-medium text-orange-800 mb-1">ğŸ”¥ ë²ˆì•„ì›ƒ ì˜ˆë°© ê´€ë¦¬</div>
                                  <div className="prose prose-xs max-w-none prose-orange">
                                    <AIAnalysisMarkdownRenderer 
                                      content="ìŠ¤íŠ¸ë ˆìŠ¤ í˜¸ë¥´ëª¬ ì¡°ì ˆê³¼ íšŒë³µíƒ„ë ¥ì„± ê°•í™”ë¥¼ í†µí•œ ë§Œì„± í”¼ë¡œ ë° ì •ì„œì  ì†Œì§„ ì˜ˆë°©"
                                      variant="compact"
                                    />
                                  </div>
                                </div>
                                
                                <div className="bg-purple-50 p-3 rounded-lg">
                                  <div className="font-medium text-purple-800 mb-1">âš¡ ì¶©ë™ì„± ì¡°ì ˆ ê´€ë¦¬</div>
                                  <div className="prose prose-xs max-w-none prose-purple">
                                    <AIAnalysisMarkdownRenderer 
                                      content="ì „ì „ë‘í”¼ì§ˆ í™œì„±í™” í›ˆë ¨ê³¼ ì–µì œ ì¡°ì ˆ ëŠ¥ë ¥ í–¥ìƒì„ í†µí•œ í–‰ë™ ì¡°ì ˆë ¥ ê°•í™”"
                                      variant="compact"
                                    />
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                  </CardContent>
                </Card>

                {/* ê°œë³„ ìœ„í—˜ë„ ë¶„ì„ - 2x2 ê·¸ë¦¬ë“œ */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {/* ìš°ìš¸ ìœ„í—˜ë„ */}
                {analysisResult.detailedAnalysis?.mentalHealthRisk?.depression && (
                  <Card className={`${
                    analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                      ? 'bg-red-50 border-red-200' 
                      : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                      ? 'bg-yellow-50 border-yellow-200' 
                      : 'bg-white border-gray-200'
                  }`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <CardTitle className={`flex items-center gap-2 ${
                            analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                              ? 'text-red-900' 
                              : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                              ? 'text-yellow-900' 
                              : 'text-gray-900'
                          }`}>
                            <Brain className={`w-5 h-5 ${
                              analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                                ? 'text-red-600' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                                ? 'text-yellow-600' 
                                : 'text-gray-600'
                            }`} />
                            ìš°ìš¸ìœ„í—˜ë„ ë¶„ì„
                      </CardTitle>
                        </div>
                        <div className="text-right">
                          <div className="text-lg font-bold text-gray-900">
                            {Math.round(analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore)}/100
                          </div>
                          <Badge 
                            variant="outline" 
                            className={
                              analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore <= 30
                                ? 'border-green-300 text-green-700 bg-green-50' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore <= 50
                                ? 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                : 'border-red-300 text-red-700 bg-red-50'
                            }
                          >
                            {analysisResult.detailedAnalysis.mentalHealthRisk.depression.status || 
                             (analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 ? 'ìœ„í—˜' : 
                              analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 ? 'ê²½ê³„' : 'ì •ìƒ')}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* ê·¸ë˜í”„ */}
                      <div className="flex justify-center">
                        <div className="w-96 h-96">
                          <MentalHealthRiskChart
                            value={analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore}
                            label="ìš°ìš¸"
                          />
                        </div>
                      </div>
                      
                      {/* í•˜ë‹¨: í•´ì„ */}
                      <div className="border-t border-gray-200 pt-3">
                        <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                        <p className="text-sm text-gray-600 leading-relaxed">
                        <AIAnalysisMarkdownRenderer content={analysisResult.detailedAnalysis.mentalHealthRisk.depression.analysis} />
                        </p>
                      </div>
                      
                      {/* ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì „ë‘ì—½ ì•ŒíŒŒ ë¹„ëŒ€ì¹­ì„±:** ${report.measurementData.eegMetrics.hemisphericBalance?.value > 0 ? 'ì¢Œë‡Œ ìš°ì„¸' : 'ìš°ë‡Œ ìš°ì„¸'} (${Math.abs(report.measurementData.eegMetrics.hemisphericBalance?.value || 0).toFixed(2)})\n\n**ì„¸íƒ€íŒŒ í™œë™:** ${report.measurementData.eegMetrics.focusIndex?.value < 2.0 ? 'ì¦ê°€' : 'ì •ìƒ'} - ìš°ìš¸ ê´€ë ¨ ì‹ ê²½ í™œë™ íŒ¨í„´ ë¶„ì„\n\n**ê°ì • ì¡°ì ˆ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.relaxationIndex?.value || 0.2} - ì •ì„œì  ì•ˆì •ì„± í‰ê°€`} />
                        </div>
                      </div>
                      
                      {/* PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.depression.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì‹¬ë°•ë³€ì´ë„(RMSSD):** ${report.measurementData.ppgMetrics.rmssd?.value || 229}ms - ììœ¨ì‹ ê²½ê³„ í™œì„±ë„\n\n**ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µë ¥:** ${report.measurementData.ppgMetrics.rmssd?.value > 50 ? 'ìš°ìˆ˜' : 'ë³´í†µ'} - ì •ì„œì  íšŒë³µ ëŠ¥ë ¥ í‰ê°€\n\n**êµê°ì‹ ê²½ í™œì„±ë„:** ${report.measurementData.ppgMetrics.lfHfRatio?.value > 5 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ìš°ìš¸ ê´€ë ¨ ìƒë¦¬ì  ë³€í™”`} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* ADHD/ì§‘ì¤‘ë ¥ ìœ„í—˜ë„ */}
                {analysisResult.detailedAnalysis?.mentalHealthRisk?.adhd && (
                  <Card className={`${
                    analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                      ? 'bg-red-50 border-red-200' 
                      : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                      ? 'bg-yellow-50 border-yellow-200' 
                      : 'bg-white border-gray-200'
                  }`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <CardTitle className={`flex items-center gap-2 ${
                            analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                              ? 'text-red-900' 
                              : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                              ? 'text-yellow-900' 
                              : 'text-gray-900'
                          }`}>
                            <Target className={`w-5 h-5 ${
                              analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                                ? 'text-red-600' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                                ? 'text-yellow-600' 
                                : 'text-gray-600'
                            }`} />
                            ADHD/ì§‘ì¤‘ë ¥ ìœ„í—˜ë„ ë¶„ì„
                      </CardTitle>
                        </div>
                        <div className="text-right">
                          <div className="text-lg font-bold text-gray-900">
                            {Math.round(analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore)}/100
                          </div>
                          <Badge 
                            variant="outline" 
                            className={
                              analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore <= 30
                                ? 'border-green-300 text-green-700 bg-green-50' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore <= 50
                                ? 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                : 'border-red-300 text-red-700 bg-red-50'
                            }
                          >
                            {analysisResult.detailedAnalysis.mentalHealthRisk.adhd.status || 
                             (analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 ? 'ìœ„í—˜' : 
                              analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 ? 'ê²½ê³„' : 'ì •ìƒ')}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* ê·¸ë˜í”„ */}
                      <div className="flex justify-center">
                        <div className="w-96 h-96">
                          <MentalHealthRiskChart
                            value={analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore}
                            label="ì§‘ì¤‘ë ¥"
                          />
                        </div>
                      </div>
                      
                      {/* í•˜ë‹¨: í•´ì„ */}
                      <div className="border-t border-gray-200 pt-3">
                        <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                        <p className="text-sm text-gray-600 leading-relaxed">
                        <AIAnalysisMarkdownRenderer content={analysisResult.detailedAnalysis.mentalHealthRisk.adhd.analysis} />
                        </p>
                      </div>
                      
                      {/* ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì£¼ì˜ì§‘ì¤‘ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.focusIndex?.value || 2.02} - ì§‘ì¤‘ë ¥ ìƒíƒœ í‰ê°€\n\n**ë² íƒ€íŒŒ í™œë™:** ${report.measurementData.eegMetrics.focusIndex?.value > 2.4 ? 'ê³¼í™œì„±' : 'ì •ìƒ'} - ADHD ê´€ë ¨ ë‡ŒíŒŒ íŒ¨í„´\n\n**ì¸ì§€ ë¶€í•˜ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.stressIndex?.value || 3.2} - ì •ë³´ ì²˜ë¦¬ ëŠ¥ë ¥ í‰ê°€`} />
                        </div>
                      </div>
                      
                      {/* PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.adhd.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì‹¬ë°•ë³€ì´ë„(SDNN):** ${report.measurementData.ppgMetrics.sdnn?.value || 188}ms - ììœ¨ì‹ ê²½ ì¡°ì ˆ ëŠ¥ë ¥\n\n**ê°ì„± ìˆ˜ì¤€:** ${report.measurementData.ppgMetrics.heartRate?.value > 80 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ê³¼í™œì„± ìƒíƒœ í‰ê°€\n\n**ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ì„±:** ${report.measurementData.ppgMetrics.lfHfRatio?.value > 8 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ì¶©ë™ì„± ê´€ë ¨ ìƒë¦¬ì  ì§€í‘œ`} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* ë²ˆì•„ì›ƒ ìœ„í—˜ë„ */}
                {analysisResult.detailedAnalysis?.mentalHealthRisk?.burnout && (
                  <Card className={`${
                    analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                      ? 'bg-red-50 border-red-200' 
                      : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                      ? 'bg-yellow-50 border-yellow-200' 
                      : 'bg-white border-gray-200'
                  }`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <CardTitle className={`flex items-center gap-2 ${
                            analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                              ? 'text-red-900' 
                              : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                              ? 'text-yellow-900' 
                              : 'text-gray-900'
                          }`}>
                            <Flame className={`w-5 h-5 ${
                              analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                                ? 'text-red-600' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                                ? 'text-yellow-600' 
                                : 'text-gray-600'
                            }`} />
                            ë²ˆì•„ì›ƒ ìœ„í—˜ë„ ë¶„ì„
                      </CardTitle>
                        </div>
                        <div className="text-right">
                          <div className="text-lg font-bold text-gray-900">
                            {Math.round(analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore)}/100
                          </div>
                          <Badge 
                            variant="outline" 
                            className={
                              analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore <= 30
                                ? 'border-green-300 text-green-700 bg-green-50' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore <= 50
                                ? 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                : 'border-red-300 text-red-700 bg-red-50'
                            }
                          >
                            {analysisResult.detailedAnalysis.mentalHealthRisk.burnout.status || 
                             (analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 ? 'ìœ„í—˜' : 
                              analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 ? 'ê²½ê³„' : 'ì •ìƒ')}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* ê·¸ë˜í”„ */}
                      <div className="flex justify-center">
                        <div className="w-96 h-96">
                          <MentalHealthRiskChart
                            value={analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore}
                            label="ë²ˆì•„ì›ƒ"
                          />
                        </div>
                      </div>
                      
                      {/* í•˜ë‹¨: í•´ì„ */}
                      <div className="border-t border-gray-200 pt-3">
                        <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                        <p className="text-sm text-gray-600 leading-relaxed">
                        <AIAnalysisMarkdownRenderer content={analysisResult.detailedAnalysis.mentalHealthRisk.burnout.analysis} />
                        </p>
                      </div>
                      
                      {/* ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.stressIndex?.value || 3.2} - ë§Œì„± ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœ í‰ê°€\n\n**í”¼ë¡œë„ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.relaxationIndex?.value < 0.18 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ì •ì‹ ì  í”¼ë¡œ ìƒíƒœ\n\n**íšŒë³µë ¥ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.relaxationIndex?.value || 0.2} - ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥ í‰ê°€`} />
                        </div>
                      </div>
                      
                      {/* PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.burnout.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì½”í‹°ì†” ë°˜ì‘ì„±:** ${report.measurementData.ppgMetrics.lfHfRatio?.value > 10 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ìŠ¤íŠ¸ë ˆìŠ¤ í˜¸ë¥´ëª¬ í™œì„±ë„\n\n**íšŒë³µíƒ„ë ¥ì„±:** ${report.measurementData.ppgMetrics.rmssd?.value > 100 ? 'ìš°ìˆ˜' : 'ë³´í†µ'} - ë§Œì„± í”¼ë¡œ ëŒ€ì‘ ëŠ¥ë ¥\n\n**ììœ¨ì‹ ê²½ ì†Œì§„ë„:** ${report.measurementData.ppgMetrics.sdnn?.value < 50 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ë²ˆì•„ì›ƒ ê´€ë ¨ ìƒë¦¬ì  ë³€í™”`} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* ì¶©ë™ì„± ìœ„í—˜ë„ */}
                {analysisResult.detailedAnalysis?.mentalHealthRisk?.impulsivity && (
                  <Card className={`${
                    analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                      ? 'bg-red-50 border-red-200' 
                      : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                      ? 'bg-yellow-50 border-yellow-200' 
                      : 'bg-white border-gray-200'
                  }`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <CardTitle className={`flex items-center gap-2 ${
                            analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                              ? 'text-red-900' 
                              : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                              ? 'text-yellow-900' 
                              : 'text-gray-900'
                          }`}>
                            <Zap className={`w-5 h-5 ${
                              analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                                ? 'text-red-600' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                                ? 'text-yellow-600' 
                                : 'text-gray-600'
                            }`} />
                            ì¶©ë™ì„± ìœ„í—˜ë„ ë¶„ì„
                      </CardTitle>
                        </div>
                        <div className="text-right">
                          <div className="text-lg font-bold text-gray-900">
                            {Math.round(analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore)}/100
                          </div>
                          <Badge 
                            variant="outline" 
                            className={
                              analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore <= 30
                                ? 'border-green-300 text-green-700 bg-green-50' 
                                : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore <= 50
                                ? 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                : 'border-red-300 text-red-700 bg-red-50'
                            }
                          >
                            {analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.status || 
                             (analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 ? 'ìœ„í—˜' : 
                              analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 ? 'ê²½ê³„' : 'ì •ìƒ')}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* ê·¸ë˜í”„ */}
                      <div className="flex justify-center">
                        <div className="w-96 h-96">
                          <MentalHealthRiskChart
                            value={analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore}
                            label="ì¶©ë™ì„±"
                          />
                        </div>
                      </div>
                      
                      {/* í•˜ë‹¨: í•´ì„ */}
                      <div className="border-t border-gray-200 pt-3">
                        <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                        <p className="text-sm text-gray-600 leading-relaxed">
                        <AIAnalysisMarkdownRenderer content={analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.analysis} />
                        </p>
                      </div>
                      
                      {/* ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì „ì „ë‘í”¼ì§ˆ í™œì„±ë„:** ${report.measurementData.eegMetrics.focusIndex?.value < 1.8 ? 'ì €í•˜' : 'ì •ìƒ'} - ì–µì œ ì¡°ì ˆ ëŠ¥ë ¥\n\n**ì¶©ë™ ì–µì œ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.hemisphericBalance?.value || -0.04} - í–‰ë™ ì¡°ì ˆ ëŠ¥ë ¥ í‰ê°€\n\n**ê°ì • ì¡°ì ˆ ëŠ¥ë ¥:** ${report.measurementData.eegMetrics.relaxationIndex?.value || 0.2} - ì •ì„œì  ì¶©ë™ì„± ê´€ë¦¬`} />
                        </div>
                      </div>
                      
                      {/* PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                          ? 'border-red-100' 
                          : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                          ? 'border-yellow-100' 
                          : 'border-gray-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 50 
                            ? 'text-red-900' 
                            : analysisResult.detailedAnalysis.mentalHealthRisk.impulsivity.riskScore > 30 
                            ? 'text-yellow-900' 
                            : 'text-gray-900'
                        }`}>PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ì‹¬ë°•ìˆ˜ ë³€ë™ì„±:** ${report.measurementData.ppgMetrics.heartRate?.value > 90 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ê°ì„± ìƒíƒœ í‰ê°€\n\n**êµê°ì‹ ê²½ ê³¼í™œì„±:** ${report.measurementData.ppgMetrics.lfHfRatio?.value > 12 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ì¶©ë™ì  ë°˜ì‘ì„±\n\n**ìê¸°ì¡°ì ˆ ëŠ¥ë ¥:** ${report.measurementData.ppgMetrics.rmssd?.value > 150 ? 'ìš°ìˆ˜' : 'ë³´í†µ'} - í–‰ë™ ì¡°ì ˆë ¥ í‰ê°€`} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* ìŠ¤íŠ¸ë ˆìŠ¤ ìœ„í—˜ë„ */}
                {analysisResult.detailedAnalysis?.mentalHealthRisk && (
                  <Card className={`${
                    75 >= 80 ? 'bg-white border-gray-200' : 75 >= 70 ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200'
                  }`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <CardTitle className={`flex items-center gap-2 ${
                            75 >= 80 ? 'text-gray-900' : 75 >= 70 ? 'text-yellow-900' : 'text-red-900'
                          }`}>
                            <Zap className={`w-5 h-5 ${
                              75 >= 80 ? 'text-gray-600' : 75 >= 70 ? 'text-yellow-600' : 'text-red-600'
                            }`} />
                            ìŠ¤íŠ¸ë ˆìŠ¤ ìœ„í—˜ë„ ë¶„ì„
                          </CardTitle>
                        </div>
                        <div className="text-right">
                          <div className="text-lg font-bold text-gray-900">
                            {Math.round(100 - 75)}/100
                          </div>
                          <Badge 
                            variant="outline" 
                            className={
                              75 >= 80
                                ? 'border-green-300 text-green-700 bg-green-50' 
                                : 75 >= 70
                                ? 'border-yellow-300 text-yellow-700 bg-yellow-50'
                                : 'border-red-300 text-red-700 bg-red-50'
                            }
                          >
                            {75 >= 80 ? 'ì •ìƒ' : 75 >= 70 ? 'ê²½ê³„' : 'ìœ„í—˜'}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {/* ê·¸ë˜í”„ */}
                      <div className="flex justify-center">
                        <div className="w-96 h-96">
                          <MentalHealthRiskChart
                            value={100 - 75}
                            label="ìŠ¤íŠ¸ë ˆìŠ¤"
                          />
                        </div>
                      </div>
                      
                      {/* í•˜ë‹¨: í•´ì„ */}
                      <div className="border-t border-gray-200 pt-3">
                        <h5 className="text-sm font-medium text-gray-700 mb-2">ì˜í•™ì  í•´ì„</h5>
                        <p className="text-sm text-gray-600 leading-relaxed">
                          <AIAnalysisMarkdownRenderer content="ë‡ŒíŒŒ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ì™€ ììœ¨ì‹ ê²½ ê· í˜• ìƒíƒœë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë ¨ ìœ„í—˜ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤. ë² íƒ€íŒŒì™€ ê°ë§ˆíŒŒì˜ ë¹„ìœ¨, HRV ì§€í‘œë¥¼ í†µí•´ ì •ì‹ ì  ê¸´ì¥ë„ì™€ íšŒë³µë ¥ì„ ì¸¡ì •í•©ë‹ˆë‹¤." />
                        </p>
                      </div>
                      
                      {/* ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        75 >= 80 ? 'border-gray-100' : 75 >= 70 ? 'border-yellow-100' : 'border-red-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          75 >= 80 ? 'text-gray-900' : 75 >= 70 ? 'text-yellow-900' : 'text-red-900'
                        }`}>ë‡ŒíŒŒ ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.stressIndex?.value || 3.2} - ë§Œì„± ìŠ¤íŠ¸ë ˆìŠ¤ ìƒíƒœ í‰ê°€\n\n**í”¼ë¡œë„ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.relaxationIndex?.value < 0.18 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ì •ì‹ ì  í”¼ë¡œ ìƒíƒœ\n\n**íšŒë³µë ¥ ì§€ìˆ˜:** ${report.measurementData.eegMetrics.relaxationIndex?.value || 0.2} - ìŠ¤íŠ¸ë ˆìŠ¤ íšŒë³µ ëŠ¥ë ¥ í‰ê°€`} />
                        </div>
                      </div>
                      
                      {/* PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€ */}
                      <div className={`border-t pt-3 ${
                        75 >= 80 ? 'border-gray-100' : 75 >= 70 ? 'border-yellow-100' : 'border-red-100'
                      }`}>
                        <h4 className={`text-sm font-medium mb-2 ${
                          75 >= 80 ? 'text-gray-900' : 75 >= 70 ? 'text-yellow-900' : 'text-red-900'
                        }`}>PPG ê¸°ë°˜ ë°”ì´ì˜¤ë§ˆì»¤ í‰ê°€</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer content={`**ììœ¨ì‹ ê²½ ê· í˜•:** ${report.measurementData.ppgMetrics.lfHfRatio?.value > 10 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ìŠ¤íŠ¸ë ˆìŠ¤ í˜¸ë¥´ëª¬ í™œì„±ë„\n\n**íšŒë³µíƒ„ë ¥ì„±:** ${report.measurementData.ppgMetrics.rmssd?.value > 100 ? 'ìš°ìˆ˜' : 'ë³´í†µ'} - ë§Œì„± í”¼ë¡œ ëŒ€ì‘ ëŠ¥ë ¥\n\n**ììœ¨ì‹ ê²½ ì†Œì§„ë„:** ${report.measurementData.ppgMetrics.sdnn?.value < 50 ? 'ë†’ìŒ' : 'ì •ìƒ'} - ë²ˆì•„ì›ƒ ê´€ë ¨ ìƒë¦¬ì  ì§€í‘œ`} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}
                </div>
              </div>
            </CardContent>
          )}
        </Card>

        {/* 4ë‹¨ê³„: ì˜í•™ì  ìœ„í—˜ë„ ë¶„ì„ */}
        <Card className="bg-white border-gray-200 shadow-sm">
          <CardHeader 
            className="cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-200"
            onClick={() => setExpandedSections(prev => ({
              ...prev,
              medicalRiskAnalysis: !prev.medicalRiskAnalysis
            }))}
          >
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center">
                  <span className="text-red-600 font-semibold text-sm">4</span>
                </div>
                <div>
                  <CardTitle className="text-lg text-gray-900">ì˜í•™ì  ìœ„í—˜ë„ ë¶„ì„</CardTitle>
                  <CardDescription className="text-gray-600">
                    ìƒì²´ì‹ í˜¸ í†µí•© ë¶„ì„ ë° ë³‘ë¦¬í•™ì  ìœ„í—˜ í‰ê°€
                  </CardDescription>
                </div>
              </div>
              {expandedSections.medicalRiskAnalysis ? (
                <ChevronUp className="w-5 h-5 text-gray-500" />
              ) : (
                <ChevronDown className="w-5 h-5 text-gray-500" />
              )}
            </div>
          </CardHeader>
          
          {expandedSections.medicalRiskAnalysis && (
            <CardContent className="p-6 bg-white">
              <div className="space-y-6">
                <div className="grid grid-cols-1 gap-6">
                  {/* ìƒì²´ì‹ í˜¸ í†µí•© ë¶„ì„ */}
                  <Card className="bg-gray-50 border-gray-200">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-gray-900">
                        <Activity className="w-5 h-5 text-green-600" />
                        ìƒì²´ì‹ í˜¸ í†µí•© ë¶„ì„
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div>
                        <h4 className="text-sm font-medium text-blue-600 mb-2">ğŸ§  ë‡ŒíŒŒ(EEG) ì˜í•™ì  í•´ì„</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer 
                            content={`**ì•ŒíŒŒíŒŒ í™œì„±ë„:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.eegMedicalInterpretation?.alphaActivity || 'ì •ìƒ ë²”ìœ„'}\n\n**ë² íƒ€íŒŒ íŒ¨í„´:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.eegMedicalInterpretation?.betaPattern || 'ì•ˆì •ì '}\n\n**ê°ë§ˆíŒŒ ë™ì¡°:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.eegMedicalInterpretation?.gammaSync || 'ì–‘í˜¸'}\n\n**ì˜í•™ì  ì†Œê²¬:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.eegMedicalInterpretation?.medicalFindings || 'ì „ë°˜ì ì¸ ë‡Œ í™œì„±ë„ê°€ ì •ìƒ ë²”ìœ„ ë‚´ì— ìˆìœ¼ë©°, ì¸ì§€ ê¸°ëŠ¥ ë° ì •ì„œ ì¡°ì ˆ ëŠ¥ë ¥ì´ ì–‘í˜¸í•œ ìƒíƒœë¡œ í‰ê°€ë©ë‹ˆë‹¤.'}`}
                            variant="compact"
                          />
                        </div>
                      </div>
                      <div>
                        <h4 className="text-sm font-medium text-red-600 mb-2">â¤ï¸ ì‹¬í˜ˆê´€(PPG) ì˜í•™ì  í•´ì„</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer 
                            content={`**ì‹¬ë°•ë³€ì´ë„(HRV):** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.ppgMedicalInterpretation?.hrv || 'ì •ìƒ'}\n\n**í˜ˆê´€ íƒ„ì„±ë„:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.ppgMedicalInterpretation?.vascularElasticity || 'ì–‘í˜¸'}\n\n**ììœ¨ì‹ ê²½ ê· í˜•:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.ppgMedicalInterpretation?.autonomicBalance || 'ê· í˜•ì '}\n\n**ì˜í•™ì  ì†Œê²¬:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.biosignalIntegration?.ppgMedicalInterpretation?.medicalFindings || 'ì‹¬í˜ˆê´€ê³„ ê¸°ëŠ¥ì´ ì •ìƒ ë²”ìœ„ì— ìˆìœ¼ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘ì„±ê³¼ íšŒë³µë ¥ì´ ì ì ˆí•œ ìˆ˜ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.'}`}
                            variant="compact"
                          />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* ë³‘ë¦¬í•™ì  ìœ„í—˜ ìš”ì†Œ í‰ê°€ */}
                  <Card className="bg-gray-50 border-gray-200">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-gray-900">
                        <Shield className="w-5 h-5 text-orange-600" />
                        ë³‘ë¦¬í•™ì  ìœ„í—˜ ìš”ì†Œ í‰ê°€
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div>
                        <h4 className="text-sm font-medium text-purple-600 mb-2">ğŸ§  ì‹ ê²½í•™ì  ìœ„í—˜ë„</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer 
                            content={`**ìœ„í—˜ ì ìˆ˜:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.neurologicalRisk?.riskScore || 0}/100\n\n**ì„¤ëª…:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.neurologicalRisk?.description || 'ìš°ìš¸, ì§‘ì¤‘ë ¥ ì¥ì•  ë“± ì‹ ê²½ì •ì‹ í•™ì  ì§ˆí™˜ ë°œìƒ ìœ„í—˜ë„'}`}
                            variant="compact"
                          />
                        </div>
                      </div>
                      <div>
                        <h4 className="text-sm font-medium text-red-600 mb-2">ğŸ’” ì‹¬í˜ˆê´€ ìœ„í—˜ë„</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer 
                            content={`**ìœ„í—˜ ì ìˆ˜:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.cardiovascularRisk?.riskScore || 0}/100\n\n**ì„¤ëª…:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.cardiovascularRisk?.description || 'ê³ í˜ˆì••, ë¶€ì •ë§¥ ë“± ì‹¬í˜ˆê´€ê³„ ì§ˆí™˜ ë°œìƒ ìœ„í—˜ë„'}`}
                            variant="compact"
                          />
                        </div>
                      </div>
                      <div>
                        <h4 className="text-sm font-medium text-orange-600 mb-2">ğŸ”¥ ëŒ€ì‚¬ ì¦í›„êµ° ìœ„í—˜ë„</h4>
                        <div className="prose prose-sm max-w-none prose-gray">
                          <AIAnalysisMarkdownRenderer 
                            content={`**ìœ„í—˜ ì ìˆ˜:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.metabolicSyndromeRisk?.riskScore || 0}/100\n\n**ì„¤ëª…:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.pathologicalRiskFactors?.metabolicSyndromeRisk?.description || 'ë‹¹ë‡¨ë³‘, ë¹„ë§Œ ë“± ëŒ€ì‚¬ì„± ì§ˆí™˜ ë°œìƒ ìœ„í—˜ë„'}`}
                            variant="compact"
                          />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* ì„ìƒì  ê¶Œê³ ì‚¬í•­ */}
                <Card className="bg-gray-50 border-gray-200">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-gray-900">
                      <FileText className="w-5 h-5 text-blue-600" />
                      ì„ìƒì  ê¶Œê³ ì‚¬í•­
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div>
                      <h4 className="text-sm font-medium text-green-600 mb-2">âœ… ì˜ˆë°© ì˜í•™ì  ì ‘ê·¼</h4>
                      <div className="prose prose-sm max-w-none prose-gray">
                        <AIAnalysisMarkdownRenderer 
                          content={`â€¢ **ì •ê¸° ê²€ì§„:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.clinicalRecommendations?.preventiveMedicine?.regularCheckups || '3-6ê°œì›” ê°„ê²©ìœ¼ë¡œ ì •ì‹ ê±´ê°• ìƒíƒœ ëª¨ë‹ˆí„°ë§ ê¶Œì¥'}\n\nâ€¢ **ìƒí™œìŠµê´€ êµì •:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.clinicalRecommendations?.preventiveMedicine?.lifestyleModifications || 'ê·œì¹™ì ì¸ ìš´ë™, ì¶©ë¶„í•œ ìˆ˜ë©´, ê· í˜•ì¡íŒ ì˜ì–‘ ì„­ì·¨'}\n\nâ€¢ **ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬:** ${analysisResult.detailedAnalysis?.medicalRiskAnalysis?.clinicalRecommendations?.preventiveMedicine?.stressManagement || 'ëª…ìƒ, ìš”ê°€, ì‹¬í˜¸í¡ ë“± ì´ì™„ ê¸°ë²• ì‹¤ì²œ'}`}
                          variant="compact"
                        />
                      </div>
                    </div>
                    <div>
                      <h4 className="text-sm font-medium text-blue-600 mb-2">ğŸ¥ ì˜ë£Œì§„ ìƒë‹´ ê¶Œì¥ ì‚¬í•­</h4>
                      <div className="prose prose-sm max-w-none prose-gray">
                        <AIAnalysisMarkdownRenderer 
                          content={analysisResult.detailedAnalysis?.medicalRiskAnalysis?.clinicalRecommendations?.medicalConsultation?.recommendations?.map((rec: string) => `â€¢ ${rec}`).join('\n\n') || 'ìœ„í—˜ë„ì— ë”°ë¥¸ ì°¨ë“± ê¶Œê³ '}
                          variant="compact"
                        />
                      </div>
                    </div>
                    <div>
                      <h4 className="text-sm font-medium text-purple-600 mb-2">ğŸ”¬ ê³¼í•™ì  ê·¼ê±°</h4>
                      <div className="prose prose-sm max-w-none prose-gray">
                        <AIAnalysisMarkdownRenderer 
                          content={analysisResult.detailedAnalysis?.medicalRiskAnalysis?.clinicalRecommendations?.scientificEvidence || 
                          'ë³¸ ë¶„ì„ì€ êµ­ì œ ì •ì‹ ì˜í•™íšŒ(IPA) ê°€ì´ë“œë¼ì¸ê³¼ DSM-5 ì§„ë‹¨ ê¸°ì¤€ì„ ì°¸ì¡°í•˜ì—¬ ë‡ŒíŒŒ-ì‹¬í˜ˆê´€ ë°”ì´ì˜¤ë§ˆì»¤ì˜ ì„ìƒì  ìœ íš¨ì„±ì„ ê²€ì¦í•œ ìµœì‹  ì—°êµ¬ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•©ë‹ˆë‹¤. (ì°¸ê³ : Nature Medicine 2024, Lancet Psychiatry 2024)'}
                          variant="compact"
                        />
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </CardContent>
          )}
        </Card>

        {/* 5ë‹¨ê³„: ë§ì¶¤í˜• ì¶”ì²œì‚¬í•­ */}
        <Card className="bg-white border-gray-200 shadow-sm">
          <CardHeader 
            className="cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-200"
            onClick={() => setExpandedSections(prev => ({
              ...prev,
              recommendations: !prev.recommendations
            }))}
          >
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center">
                  <span className="text-yellow-600 font-semibold text-sm">5</span>
                </div>
                <div>
                  <CardTitle className="text-lg text-gray-900">ë§ì¶¤í˜• ì¶”ì²œì‚¬í•­</CardTitle>
                  <CardDescription className="text-gray-600">
                    ê°œì¸ ë§ì¶¤í˜• ê±´ê°• ê´€ë¦¬ ê°€ì´ë“œ
                  </CardDescription>
                </div>
              </div>
              {expandedSections.recommendations ? (
                <ChevronUp className="w-5 h-5 text-gray-500" />
              ) : (
                <ChevronDown className="w-5 h-5 text-gray-500" />
              )}
            </div>
          </CardHeader>
          
                     {expandedSections.recommendations && (
             <CardContent className="p-6 bg-white">
               {analysisResult.personalizedRecommendations ? (
                 <div className="space-y-6">
                   {/* ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜ */}
                   <Card className="bg-gray-50 border-gray-200">
                     <CardHeader>
                       <CardTitle className="flex items-center gap-2 text-gray-900">
                         <CheckCircle className="w-5 h-5 text-green-600" />
                         ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜
                       </CardTitle>
                     </CardHeader>
                     <CardContent className="space-y-4">
                       <div>
                         <h4 className="text-sm font-medium text-blue-600 mb-2">ìƒí™œìŠµê´€</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.immediate.lifestyle.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                       <div>
                         <h4 className="text-sm font-medium text-green-600 mb-2">ìš´ë™</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.immediate.exercise.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                     </CardContent>
                   </Card>

                   {/* ë‹¨ê¸° ëª©í‘œ */}
                   <Card className="bg-gray-50 border-gray-200">
                     <CardHeader>
                       <CardTitle className="flex items-center gap-2 text-gray-900">
                         <Target className="w-5 h-5 text-orange-600" />
                         ë‹¨ê¸° ëª©í‘œ (1-4ì£¼)
                       </CardTitle>
                     </CardHeader>
                     <CardContent className="space-y-4">
                       <div>
                         <h4 className="text-sm font-medium text-blue-600 mb-2">ìƒí™œìŠµê´€</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.shortTerm.lifestyle.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                       <div>
                         <h4 className="text-sm font-medium text-orange-600 mb-2">ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.shortTerm.stressManagement.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                     </CardContent>
                   </Card>

                   {/* ì¥ê¸° ëª©í‘œ */}
                   <Card className="bg-gray-50 border-gray-200">
                     <CardHeader>
                       <CardTitle className="flex items-center gap-2 text-gray-900">
                         <TrendingUp className="w-5 h-5 text-purple-600" />
                         ì¥ê¸° ëª©í‘œ (1-3ê°œì›”)
                       </CardTitle>
                     </CardHeader>
                     <CardContent className="space-y-4">
                       <div>
                         <h4 className="text-sm font-medium text-purple-600 mb-2">ì •ì‹ ê±´ê°• ê´€ë¦¬</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.longTerm.mentalCare.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                       <div>
                         <h4 className="text-sm font-medium text-pink-600 mb-2">ì‚¬íšŒì  ì§€ì›</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.longTerm.socialSupport.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                     </CardContent>
                   </Card>

                   {/* ì§ì—…ë³„ íŠ¹í™” ì¶”ì²œ */}
                   <Card className="bg-gray-50 border-gray-200">
                     <CardHeader>
                       <CardTitle className="flex items-center gap-2 text-gray-900">
                         <Briefcase className="w-5 h-5 text-teal-600" />
                         ì§ì—…ë³„ íŠ¹í™” ì¶”ì²œ
                       </CardTitle>
                     </CardHeader>
                     <CardContent className="space-y-4">
                       <div>
                         <h4 className="text-sm font-medium text-indigo-600 mb-2">ì§ì¥ ì „ëµ</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.occupationSpecific.workplaceStrategies.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                       <div>
                         <h4 className="text-sm font-medium text-teal-600 mb-2">ì‹œê°„ ê´€ë¦¬</h4>
                         <div className="prose prose-sm max-w-none prose-gray">
                           <AIAnalysisMarkdownRenderer 
                             content={analysisResult.personalizedRecommendations.occupationSpecific.timeManagement.join('\n\n')}
                             variant="compact"
                           />
                         </div>
                       </div>
                     </CardContent>
                   </Card>
                 </div>
               ) : (
                 <div className="prose prose-sm max-w-none prose-gray">
                   <AIAnalysisMarkdownRenderer 
                     content="ì¶”ì²œì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
                     variant="compact"
                   />
                 </div>
               )}
             </CardContent>
           )}
        </Card>
      </div>
    </div>
  );
};

export default ReportDetailViewer; 